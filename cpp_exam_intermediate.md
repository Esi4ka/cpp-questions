# Intermediate

## 1

```cpp
for (int i = 0; i < 300; ++i)
    std::cout << i << ' ' << i * 12345678 << std::endl;
```

—Å -O2 –±—É–¥–µ—Ç infinite loop. –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç –∏—Å—Ö–æ–¥—è –∏–∑ —É—Å–ª–æ–≤–∏—è, —á—Ç–æ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ. –ï—Å–ª–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω, —Ç–æ –ø—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ—Ç—Å—è, —á—Ç–æ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è (i < 174 - –∫–æ–≥–¥–∞ –Ω–µ—Ç –ø–µ—Ä–µ–ø–æ–ª–Ω–µ–Ω–∏—è).  i < 300 –≤—Å–µ–≥–¥–∞ –∏—Å—Ç–∏–Ω–Ω–æ –∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∑–∞–º–µ–Ω—è–µ—Ç —ç—Ç–æ –Ω–∞ true

**-Werror** - —Ç—Ä–∞–∫—Ç–æ–≤–∞—Ç—å –≤–æ—Ä–Ω–∏–Ω–≥–∏ –∫–∞–∫ –æ—à–∏–±–∫–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

## 2

***Operator precedence*** specifies the order in which an expression should be *parsed*. It is similar to the use of operators in mathematics and tells us which operand that belongs ("glues") to which operator. In an expression such as `a + b * c`, operator precedence specifies that the expression must be treated as equivalent to `a + (b * c)`.

***Order of evaluation*** specifies the order in which an expression should be *executed*. That is the order in which the functions `a()`, `b()` and `c()` are executed. It is obvious that `b()` and `c()` must be called before `b() * c()` can be calculated, but it is less obvious that all three functions `a()`, `b()` and `c()` might be called in advance and that a() might be called first. The order in which they are called/executed is the order of evaluation.

**Unspecified behaviour**

–¢–µ—Ä–º–∏–Ω –æ–∑–Ω–∞—á–∞–µ—Ç, —á—Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–∞–ª–∏–¥–Ω–æ–≥–æ C++ –∫–æ–¥–∞ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ c—Ç–∞–Ω–¥–∞—Ä—Ç–æ–º –∏ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏. –ü—Ä–∏–º–µ—Ä: –ø–æ—Ä—è–¥–æ–∫ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è –∑–Ω–∞—á–µ–Ω–∏–π  –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º, –Ω–æ –Ω–∏–≥–¥–µ –Ω–µ—Ç –æ–ø–∏—Å–∞–Ω–∏—è, –∫–∞–∫ –∏–º–µ–Ω–Ω–æ. –°—Ç–∞–Ω–¥–∞—Ä—Ç –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞–º: —ç—Ç–æ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ  –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –Ω–∏–≥–¥–µ, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ, –Ω–∞ –Ω–∏—Ö –Ω–µ–ª—å–∑—è –ø–æ–ª–∞–≥–∞—Ç—å—Å—è. –ü–æ—ç—Ç–æ–º—É –∏  –ø–æ–≤–µ–¥–µ–Ω–∏–µ –≤–∞—à–µ–≥–æ –∫–æ–¥–∞ –Ω–µ –¥–æ–ª–∂–Ω–æ –∑–∞–≤–∏—Å–µ—Ç—å –æ—Ç —ç—Ç–∏—Ö –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–µ–π.

**Undefined behaviour**

```cpp
int bar() {
    int* p = nullptr;
    return *p;        // Unconditional UB
}
```



## 3

**static_cast<...>(...)** - –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö, –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞ –µ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º –≤–æ –≤—Ä–µ–º—è –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ (–æ–¥–Ω–∞–∫–æ, —Ç–æ–ª—å–∫–æ –Ω–∞ –æ—Å–Ω–æ–≤–µ compile-time –¥–∞–Ω–Ω—ã—Ö)

```cpp
CE - –¥–≤–∞ –∫–ª–∞—Å—Å–∞ —Å user-defined –∫–æ–Ω–≤–µ—Ä—Å–∏—è–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –¥—Ä—É–≥ –∫ –¥—Ä—É–≥—É
UB - long –∫ int
```



**const_cast<...>(...)**  - –Ω–∞ —Å–ª—É—á–∞–π, –µ—Å–ª–∏ —Ö–æ—Ç–∏–º –Ω–∞—Ä—É—à–∏—Ç—å –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ—Å—Ç—å (reinterpret_cast –µ–µ –≤—Å–µ –∂–µ —É–≤–∞–∂–∞–µ—Ç)

```cpp
const int x = 1;
int& x = const_cast<int&>(x); // –±–µ–∑ –∫–∞—Å—Ç–∞ —ç—Ç–æ –±—ã–ª–æ –±—ã CE
x = 2; // OK, but UB
```

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ:

```cpp
f (int& x);
f (const int& x);

—Ö–æ—Ç–∏–º –∑–∞–ø—É—Å—Ç–∏—Ç—å f() –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–≥–æ –∏–Ω—Ç–∞ –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ
```





**reinterpret_cast<...>(...)**  - –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –≤ —Å–º—ã—Å–ª–µ –Ω–∞–±–æ—Ä–∞ –±–∞–π—Ç–æ–≤ –∫–∞–∫ –¥—Ä—É–≥–æ–π —Ç–∏–ø –¥–∞–Ω–Ω—ã—Ö

```cpp
int x = 3;
double* d = reinterpret_cast<double*>(&x);
// —Ç–µ–ø–µ—Ä—å —Å–º–æ—Ç—Ä–∏–º –Ω–∞ x –∫–∞–∫ –Ω–∞ double
```

```cpp
–ü—Ä–∏–º–µ—Ä CE, RC —É–≤–∞–∂–∞–µ—Ç –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ—Å—Ç—å
const int x = 3;
int* d = reinterpret_cast<int*>(&x);
```

```cpp
–ü—Ä–∏–º–µ—Ä UB
int* x = new int(5);
std::cout << reinterpret_cast<int&>(x); // –∫–∞—Å—Ç —É–∫–∞–∑–∞—Ç–µ–ª—è –∫ —Å—Å—ã–ª–∫–µ
```

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: –ø—Ä–µ–¥—Å—Ç–∞–≤–∏—Ç—å –æ–±—ä–µ–∫—Ç –∫–∞–∫ –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å –±–∞–π—Ç–æ–≤ (uint8_t)

**c-style** - –ø—ã—Ç–∞–µ—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –≤—Å–µ, —á—Ç–æ–±—ã –ø–æ–ª—É—á–∏–ª–æ—Å—å —Å–∫–∞—Å—Ç–æ–≤–∞—Ç—å: const, static, static+const, reinterpret, reinterpret+const.

## 4

**–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ** - –∏–º–µ—é—Ç —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–µ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏

–°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –¥–∞–∂–µ –ø–æ—Å–ª–µ –≤—ã—Ö–æ–¥–∞ –∏–∑ –±–ª–æ–∫–∞, –≤ –∫–æ—Ç–æ—Ä–æ–º –æ–Ω–∞  –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∞. –¢–æ –µ—Å—Ç—å –æ–Ω–∞ —Å–æ–∑–¥–∞–µ—Ç—Å—è (–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ—Ç—Å—è) —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω —Ä–∞–∑, –∞ –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤—Å–µ–π –ø—Ä–æ–≥—Ä–∞–º–º—ã. –ö—Ä–æ–º–µ —Ç–æ–≥–æ, –≤—ã—Ö–æ–¥—è –∏–∑ –æ–±–ª–∞—Å—Ç–∏ –≤–∏–¥–∏–º–æ—Å—Ç–∏, –æ–Ω–∞ –Ω–µ —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è.

```cpp
int incrementor() {
    static int x = 0;
    ++x;
    std::cout << x << '\n';
}

incrementor(); incrementor(); incrementor();
>> 1 2 3
```

**–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—è –∏ –º–µ—Ç–æ–¥—ã –∫–ª–∞—Å—Å–∞**

–•—Ä–∞–Ω—è—Ç—Å—è –≤ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ –ø–∞–º—è—Ç–∏, –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –∏ –æ–±—â–∏–µ –¥–ª—è –≤—Å–µ—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –∫–ª–∞—Å—Å–∞

–ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ: –ø–æ–¥—Å—á–µ—Ç –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ–±—ä–µ–∫—Ç–æ–≤ –∫–ª–∞—Å—Å–∞ (–ø–æ–ª–µ), –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ (–º–µ—Ç–æ–¥—ã)

```cpp
class Singleton {
    static Singleton* obj;
    Singleton() {}
public:
    static Singleton& get() {
        if (obj) return *obj;
        obj = new Singleton();
        return *obj;
    }
    void destroy() { delete obj; }
};

Singleton* Singleton::obj = nullptr;
// –µ—Å–ª–∏ static –ø–æ–ª–µ –Ω–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–∞ –∏ –Ω–µ –∏–º–µ–µ—Ç —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞, —Ç–æ
// –º–æ–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –≤–Ω–µ –∫–ª–∞—Å—Å–∞
```

****

**–í–∏–¥—ã –ø–∞–º—è—Ç–∏**

**–°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π** ‚Äî –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø–∞–º—è—Ç–∏ –¥–æ –Ω–∞—á–∞–ª–∞ –∏—Å–ø–æ–ª–Ω–µ–Ω–∏—è  –ø—Ä–æ–≥—Ä–∞–º–º—ã. –¢–∞–∫–∞—è –ø–∞–º—è—Ç—å –¥–æ—Å—Ç—É–ø–Ω–∞ –Ω–∞ –ø—Ä–æ—Ç—è–∂–µ–Ω–∏–∏ –≤—Å–µ–≥–æ –≤—Ä–µ–º–µ–Ω–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è  –ø—Ä–æ–≥—Ä–∞–º–º—ã. –¢–∞–º —Ö—Ä–∞–Ω—è—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

**–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è**, ¬´—Ä–∞–∑–º–µ—â–µ–Ω–∏–µ –Ω–∞  —Å—Ç–µ–∫–µ¬ª, ‚Äî —Å–∞–º—ã–π –æ—Å–Ω–æ–≤–Ω–æ–π, –≤—ã–¥–µ–ª—è–µ—Ç—Å—è –ø—Ä–∏ –≤–≤–æ–¥–µ –Ω–æ–≤–æ–π –æ–±–ª–∞—Å—Ç–∏ –¥–µ–π—Å—Ç–≤–∏—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–∞–µ—Ç –ø–∞–º—è—Ç—å –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ –∏–∑ –Ω–µ—ë. 

## 5

**private** - –¥–æ—Å—Ç—É–ø –∫ –º–µ—Ç–æ–¥–∞–º –∏ –ø–æ–ª—è–º –æ—Ç–∫—Ä—ã—Ç –≤–Ω—É—Ç—Ä–∏ –∫–ª–∞—Å—Å–∞ –∏ –¥–ª—è –¥—Ä—É–∑–µ–π –∫–ª–∞—Å—Å–∞. –ü—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–µ —ç—Ç–æ–≥–æ –∫–ª–∞—Å—Å–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–µ –∏–º–µ—é—Ç

**public** - –¥–æ—Å—Ç—É–ø –æ—Ç–∫—Ä—ã—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ –≤—Å–µ–º, –∫—Ç–æ –≤–∏–¥–∏—Ç –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω–æ–≥–æ –∫–ª–∞—Å—Å–∞

**–ò–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è** ‚Äî –º–µ—Ö–∞–Ω–∏–∑–º —É–ø–∞–∫–æ–≤–∫–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —Ñ—É–Ω–∫—Ü–∏–π –≤ –µ–¥–∏–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç (–∞ —Ç–∞–∫–∂–µ –∏–Ω–∫–∞–ø—Å—É–ª—è—Ü–∏—è –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–≥—Ä–∞–Ω–∏—á–∏—Ç—å –¥–æ—Å—Ç—É–ø –æ–¥–Ω–∏—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ –ø—Ä–æ–≥—Ä–∞–º–º—ã –∫ –¥—Ä—É–≥–∏–º). –û–¥–∏–Ω –∏–∑ —Ç—Ä—ë—Ö –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –û–û–ü. –ü–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å –æ–±—ä–µ–∫—Ç–æ–º —á–µ—Ä–µ–∑ –∞–±—Å—Ç—Ä–∞–∫—Ü–∏–∏, –Ω–µ –∑–∞–¥—É–º—ã–≤–∞—è—Å—å –æ–± –∏—Ö —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏.

**–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –º–µ—Ç–æ–¥–æ–≤ –≤ —Å–ª—É—á–∞–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–∏–≤–∞—Ç–Ω—ã—Ö –∏ –ø—É–±–ª–∏—á–Ω—ã—Ö –≤–µ—Ä—Å–∏–π**

```cpp
class C {    
    private:    
    void add(int a) {}    
    public:    
    void add(double a) {}
};
C c;
c.add(1); // CE
```

–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å. –¢–µ–º —Å–∞–º—ã–º –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –æ—Ç —Ç–∞–∫–æ–π —Å–∏–≥–Ω–∞—Ç—É—Ä—ã —Ñ—É–Ω–∫—Ü–∏—é –≤—ã–∑–≤–∞—Ç—å –Ω–µ–ª—å–∑—è. –°–Ω–∞—á–∞–ª–∞ –ø–µ—Ä–µ–≥—Ä—É–∑–∏–º, –ø–æ—Ç–æ–º –ø–æ–π–º–µ–º, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è –ø—Ä–∏–≤–∞—Ç–Ω–∞—è, –¥–∞–ª—å—à–µ –°–ï.



**–î—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** (–∏–ª–∏ –∫–ª–∞—Å—Å—ã) ‚Äî —ç—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ (–∏–ª–∏ –∫–ª–∞—Å—Å—ã), –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ —è–≤–ª—è—é—Ç—Å—è —á–ª–µ–Ω–∞–º–∏ –∫–ª–∞—Å—Å–∞, –æ–¥–Ω–∞–∫–æ –∏–º–µ—é—Ç –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º—É, –∫ —á–µ–º—É –∏–º–µ–µ—Ç –¥–æ—Å—Ç—É–ø —Ç–µ–∫—É—â–∏–π –∫–ª–∞—Å—Å, –∫—Ä–æ–º–µ –ø–æ–ª–µ–π/–º–µ—Ç–æ–¥–æ–≤ –∫–ª–∞—Å—Å–∞, —á—å–∏–º –¥—Ä—É–≥–æ–º —è–≤–ª—è–µ—Ç—Å—è –Ω–∞—à –∫–ª–∞—Å—Å ‚Äî –¥—Ä—É–∂–±–∞ –Ω–µ —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∞. –î–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –¥—Ä—É–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π (–∏–ª–∏ –∫–ª–∞—Å—Å–æ–≤) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ friend. –ß–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, –∫–æ–≥–¥–∞ –ª–µ–≤—ã–π –æ–ø–µ—Ä–∞–Ω–¥ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è —á–ª–µ–Ω–æ–º –∫–ª–∞—Å—Å–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤–≤–æ–¥ –∏ –≤—ã–≤–æ–¥ –≤ –ø–æ—Ç–æ–∫).

```cpp
class String {
  char* buffer;
  size_t size;
public:
  String(const char[]);
  //  –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –æ–ø–µ—Ä–∞—Ç–æ—Ä –≤—ã–≤–æ–¥–∞ –≤ –ø–æ—Ç–æ–∫
  friend std::ostream& operator<<(std::ostream& out, const String& s);
  friend std::istream& operator>>(std::istream& in, const String& s);
};

std::istream& operator>>(std::istream& in, const String& s) {
    char t;
    while (std::cin >> t) {
        ...
    }
}
 
std::ostream& operator<<(std::ostream& out, const String& s) {
 for (int i = 0; i < s.size; ++i) {
   out << s.buffer[i];
 }
 return out;
}

```

## 6

**–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤** - –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç user-defined –∫–ª–∞—Å—Å–∞–º –±—ã—Ç—å –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º—ã–º–∏ –≤ –¥—Ä—É–≥–∏–µ —Ç–∏–ø—ã

```cpp
operator int() { // –Ω–µ –∏–º–µ–µ—Ç —Ç–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
    return smth;
}
```

type => MyType - —Å –ø–æ–º–æ—â—å—é –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤, –æ–±—Ä–∞—Ç–Ω–æ - –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞

**Explicit** —Å—Ç–∞–≤–∏—Ç—Å—è –ø–µ—Ä–µ–¥ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º/–æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–º –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–∞ –∏ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É –Ω–µ—è–≤–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ —Å –µ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º. –ü–æ–º–µ—á–∞—Ç—å –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –∫–ª–∞—Å—Å–æ–≤ explicit –≤–æ –∏–∑–±–µ–∂–∞–Ω–∏–µ –Ω–µ–ø—Ä–µ–¥–≤–∏–¥–µ–Ω–Ω—ã—Ö –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–π (–Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö —Ñ—É–Ω–∫—Ü–∏–π) ‚Äî —Ä–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞.

```cpp
struct U {
    int id = 0;
    public:
    explicit U(int id): id(id) {}
    explicit operator int() {
        return id;
    }
}

U id = 5; // CE due to explicit constructor
5 + id; // CE due to explicit operator
```



–ü—Ä–∏–º–µ—Ä: –∫–∞—Ä—Ç—ã, –º–Ω–æ–≥–æ —Ñ—É–Ω–∫—Ü–∏–π, –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Å–Ω–∞—á–∞–ª–∞ –¥–æ–ª–≥–æ—Ç–∞, –ø–æ—Ç–æ–º —à–∏—Ä–æ—Ç–∞, –∏ –Ω–∞–æ–±–æ—Ä–æ—Ç. –ß—Ç–æ–±—ã –Ω–µ –∑–∞–ø—É—Ç–∞—Ç—å—Å—è, –≤–≤–µ–¥–µ–º —Ç–∏–ø—ã —à–∏—Ä–æ—Ç—ã –∏ –¥–æ–ª–≥–æ—Ç—ã –∏ –∑–∞–ø—Ä–µ—Ç–∏–º –Ω–µ—è–≤–Ω—ã–µ –∫–æ–Ω–≤–µ—Ä—Å–∏–∏ –æ–¥–Ω–æ–≥–æ –∫ –¥—Ä—É–≥–æ–º—É.

**–õ–∏—Ç–µ—Ä–∞–ª** ‚Äî —ç—Ç–æ –Ω–µ–∫–æ—Ç–æ—Ä–æ–µ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, —Å–æ–∑–¥–∞—é—â–µ–µ –æ–±—ä–µ–∫—Ç:

```cpp
'x';      // character
"some";   // c-style string
7.2f;     // float
74u;      // unsigned int
74l;      // long
```

–ú–æ–∂–Ω–æ —Å–æ–∑–¥–∞–≤–∞—Ç—å —Å–≤–æ–∏, –ø—Ä–∏ —ç—Ç–æ–º –æ–ø—Ä–µ–¥–µ–ª—è—Ç—å –∏ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –Ω—É–∂–Ω–æ –≤–Ω–µ –∫–ª–∞—Å—Å–∞.

```cpp
// —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –ª–∏—Ç–µ—Ä–∞–ª–∞ –¥–ª—è —Ü–µ–ª–æ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤
OutputType operator "" _suffix(unsigned long long);

// —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –ª–∏—Ç–µ—Ä–∞–ª–∞ –¥–ª—è –≤–µ—â–µ—Å—Ç–≤–µ–Ω–Ω—ã—Ö —Ç–∏–ø–æ–≤
OutputType operator "" _suffix(long double);

42_suffix;      // OutputType operator "" _suffix(unsigned long long);
42.24_suffix;   // OutputType operator "" _suffix(long double);
```

```cpp
#include <iostream>
using namespace std;

class Lit {
	int id;
public:
	Lit(int val): id(id) {}
};

Lit operator "" _suffix(unsigned long long val) {
	return Lit(val);
}

int main() {
	343_suffix;
	return 0;
}
```

## 7

**Protected** - –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä –¥–æ—Å—Ç—É–ø–∞, –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ª—è–º –∏ –º–µ—Ç–æ–¥–∞–º –æ—Ç–∫—Ä—ã—Ç –∫–ª–∞—Å—Å–∞–º, –ø—Ä–æ–∏–∑–≤–æ–¥–Ω—ã–º –æ—Ç –¥–∞–Ω–Ω–æ–≥–æ (–Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞–º), –∏ –¥—Ä—É–∑—å—è–º.

**–¢–∏–ø—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è**

```cpp
// –û—Ç–∫—Ä—ã—Ç–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
class Pub: public Parent { };
 
// –ó–∞–∫—Ä—ã—Ç–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
class Pri: private Parent { };

// –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é - private –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
```

- public –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
  - –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞–º –¥–æ—Å—Ç—É–ø–Ω—ã public, protected –ø–æ–ª—è, private –∑–∞–ø—Ä–µ—â–µ–Ω—ã
- private –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ
  - private —Ä–æ–¥–∏—Ç–µ–ª—è –∏–∑ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã, protected –∏ public —Ä–æ–¥–∏—Ç–µ–ª—è –≤ —Ç–µ–ª–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞ —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è private

–£ —Å—Ç—Ä—É–∫—Ç—É—Ä –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é public, —É –∫–ª–∞—Å—Å–æ–≤ - private

**–†–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –≤–∏–¥–∏–º–æ—Å—Ç—å—é –∏ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é**

–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º—É –ø–æ–ª—é –∏–∑–≤–Ω–µ –Ω–µ —Ç–æ –∂–µ —Å–∞–º–æ–µ, —á—Ç–æ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –ø–æ–ª—é.

```cpp
struct Mom {
    void f() {}
}
struct Son: Mom {
    void f() {}
}

Son s;
s.f(); // –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–∞—Å—Ç–Ω–æ–µ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ –æ–±—â–µ–≥–æ
s.Mom::f(); // —è–≤–Ω–æ–µ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –º–µ—Ç–æ–¥–∞–º —Ä–æ–¥–∏—Ç–µ–ª—è
```

–ù–∞–≥–ª—è–¥–Ω–æ —Ä–∞–∑–Ω–∏—Ü–∞ –º–µ–∂–¥—É –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å—é –∏ –≤–∏–¥–∏–º–æ—Å—Ç—å—é: –º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–∞ –Ω–µ –≤–ª–∏—è—é—Ç –Ω–∞ –≤—ã–±–æ—Ä –≤–µ—Ä—Å–∏–π

```cpp
struct Mom {
    void f() {}
    void g(double) {}
}

struct Son: Mom {
private:
    void f() {}
public:
    void g(int) {}
}

Son s;
s.f();
// f –∏–∑ Mom is not visible, f –∏–∑ Son –µ–µ –∑–∞—Ç–º–µ–≤–∞–µ—Ç
// –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (–º–æ–¥–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã –¥–æ—Å—Ç—É–ø–∞) –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –ø–æ—Å–ª–µ
// –≤—ã–±–æ—Ä–∞ –≤–µ—Ä—Å–∏–π –∏ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ (–≤—ã–±—Ä–∞–ª–∏ Son::f() –Ω–∞ –ø—Ä–µ–¥. —à–∞–≥–µ)
// –ü–æ–ª—É—á–∞–µ—Ç—Å—è, –±—É–¥–µ—Ç CE, –≤–µ—Ä—Å–∏–∏ —Å—ã–Ω–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã

// –ü—Ä–∏ —ç—Ç–æ–º s.Mom::f() –¥–æ—Å—Ç—É–ø–Ω–∞, –Ω–æ –Ω–µ –≤–∏–¥–Ω–∞, s.f() –≤–∏–¥–Ω–∞, –Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞

s.g(0.0); // –≤–µ—Ä—Å–∏—è Mom –ù–ï –≤–∏–¥–Ω–∞, —Å—Ä–∞–±–æ—Ç–∞–µ—Ç –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ –∫ –≤–µ—Ä—Å–∏–∏ Son
```

**using**

```cpp
struct Son: Mom {
    using Mom::f;
}

// —Ç–µ–ø–µ—Ä—å –≤–µ—Ä—Å–∏–∏ —Ä–æ–¥–∏—Ç–µ–ª—è –≤–∏–¥–Ω—ã –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É
```

**extra**

–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –Ω–µ –Ω–∞—Å–ª–µ–¥—É—é—Ç—Å—è, –Ω–æ –≤ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–µ –º–æ–∂–Ω–æ –Ω–∞–ø–∏—Å–∞—Ç—å using Base::Base; –∏ —Ç–æ–≥–¥–∞ –º–æ–∂–Ω–æ –±—É–¥–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–≤ —á–µ—Ä–µ–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —Ä–æ–¥–∏—Ç–µ–ª–µ–π

## 8

**–ü–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤/–¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤**

*–ö–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã –≤—ã–∑—ã–≤–∞—é—Ç—Å—è –≤ —Ç–æ–º –ø–æ—Ä—è–¥–∫–µ, –≤ –∫–æ—Ç–æ—Ä–æ–º –∫–ª–∞—Å—Å—ã –≤—ã–≤–æ–¥–∏–ª–∏—Å—å –æ–¥–∏–Ω –∏–∑ –¥—Ä—É–≥–æ–≥–æ. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–∑–æ–≤–∞ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –æ–±—Ä–∞—Ç–Ω—ã–π.*

–ü–µ—Ä–µ–¥ —Ç–µ–º, –∫–∞–∫ –≤—ã–∑–æ–≤–µ—Ç—Å—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä, –ø–æ–ª—è –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Å–æ–∑–¥–∞–Ω—ã –∏ –ø—Ä–æ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω—ã.

```cpp
struct A {
    A() {std::cout << 'A';}
    ~A() {std::cout << '~A';}
};

struct B {
    B() {std::cout << 'B';}
    ~B() {std::cout << '~B';}
};

struct Base {
    A a;
    Base() {std::cout << 'Base';}
    ~Base() {std::cout << '~Base';}
};

struct Derived : Base {
    B b;
    Derived() {std::cout << 'Derived';}
    ~Derived() {std::cout << '~Derived';}
}

Derived d;
// order:
// entering Derived
// init fields of parent - Base
// entering Base
// init field A
// entering A and init fields (empty)
// creation of A - print(A)
// return to Base: creation of Base - print(Base)
// return to Derived: Base fully inited, creation of B - print(B)
// fields inited, creation of Derived - print(Derived)

// destruct Derived - print(~Derived), print(~Base), print(~A)
```

**–û–±—Ä–∞—â–µ–Ω–∏–µ –∫ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞–º —Ä–æ–¥–∏—Ç–µ–ª—è –∏–∑ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∞**

```cpp
class Derived : public Base {
    int y = 0;
    Derived(int x, int y): Base(x), y(y) {}
}

// —Å–Ω–∞—á–∞–ª–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª—è, –ø–æ—Ç–æ–º —É–∂–µ —Å–≤–æ–∏ –ø–æ–ª—è (–∏–Ω–∞—á–µ warning)
// –Ω–∞–ø—Ä—è–º—É—é –ø–æ–ª—è —Ä–æ–¥–∏—Ç–µ–ª—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –Ω–µ–ª—å–∑—è
```

**–ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ**

```cpp
struct Mom {
    int a = 0;
    int m = 1;
}

struct Dad {
    int a = 1;
    int f = 2;
}

struct Son : Mom, Dad {
    int s = 3;
}

// [ Mom::m ][ Dad::f ][ Son::s ] - —Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ø–∞–º—è—Ç–∏ Son (12 –±–∞–π—Ç)

Son s;
print(&s);

Father* pf = &s; // —Å–º–æ—Ç—Ä–∏–º –Ω–∞ —Å—ã–Ω–∞ –∫–∞–∫ –Ω–∞ –æ—Ç—Ü–∞
// –ø–æ–ª—É—á–∏–º —Å–º–µ—â–µ–Ω–∏–µ —É–∫–∞–∑–∞—Ç–µ–ª—è (—Å–¥–≤–∏–≥ –Ω–∞ 4 –±–∞–π—Ç–∞ –≤–ø—Ä–∞–≤–æ)
print(pf); 

static_cast<Son*>(pf); // –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –¥–µ–π—Å—Ç–≤—É–µ—Ç –∏–∑ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏—è, —á—Ç–æ –∫–∞—Å—Ç –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
// —Å–¥–≤–∏–≥ —É–∫–∞–∑–∞—Ç–µ–ª—è –≤–ª–µ–≤–æ –Ω–∞ 4 –±–∞–π—Ç–∞

s.a; // ambigious call
```

**–ü—Ä–æ–±–ª–µ–º–∞ —Ä–æ–º–±–æ–≤–∏–¥–Ω–æ–≥–æ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è**



```cpp
struct Granny {
    int g = 0;
}

struct Mom : Granny {
    int m = 1;
}

struct Dad: Granny {
    int f = 2;
}

struct Son: Mom, Dad {
    int s = 3;
}

// [ g ][ m ][ g ][ f ][ s ]

Son s;/
s.g; // CE
Granny& g = s; // CE
s.Mom::Granny::g(); // CE
```

–¢—É—Ç —É —Å—ã–Ω–∞ –¥–≤–µ —Ä–∞–∑–Ω—ã–µ –±–∞–±—É—à–∫–∏. 

## 14

–ö–∞—Å—Ç –≤–Ω–∏–∑ - CE (–ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ —Ä–æ–¥–∏—Ç–µ–ª—è —Ç—É–¥–∞, –≥–¥–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è –Ω–∞—Å–ª–µ–¥–Ω–∏–∫)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤ –ø—Ä–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏, –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏**

–ü—Ä–∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω–æ–º static_cast –±—É–¥–µ—Ç –ø—ã—Ç–∞—Ç—å—Å—è –¥–≤–∏–≥–∞—Ç—å —É–∫–∞–∑–∞—Ç–µ–ª–∏:

![image-20210623135643074](/home/h4zzkr/snap/typora/39/.config/Typora/typora-user-images/image-20210623135643074.png)

reinterpret_cast –Ω–∏—á–µ–≥–æ –¥–≤–∏–≥–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç, –∞ –ø—Ä–æ—Å—Ç–æ –ø–æ—Å—á–∏—Ç–∞–µ—Ç, —á—Ç–æ –Ω–∞—á–∞–ª–æ Father - —ç—Ç–æ –Ω–∞—á–∞–ª–æ Son, –≤—ã–≤–µ–¥–µ—Ç—Å—è 2 –≤ –ø–æ—Å–ª–µ–¥–Ω–µ–π —Å—Ç—Ä–æ—á–∫–µ

**–ü—Ä–∏–≤–µ–¥–µ–Ω–∏—è**

```cpp
Derived d;
Base b = d; // –æ—Ç—Ä–µ–∑–∞—Ç—å –≤—Å–µ, —á—Ç–æ –æ—Ç–Ω–æ—Å–∏—Ç—Å—è –∫ derived –∏ —Å–æ–∑–¥–∞—Ç—å –Ω–∞ –æ—Å–Ω–æ–≤–µ –æ—Å—Ç–∞–≤—à–µ–≥–æ—Å—è Base b

Base& bb = d; // —Ç—Ä–∞–∫—Ç—É–µ–º derived –∫–∞–∫ Base

Base* pb = &d; // OK
Derived* pd = pb; // CE
```

–ü—Ä–∏–≤–∞—Ç–Ω–æ–µ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–∞–µ—Ç –∫–∞—Å—Ç—ã –∫ —Ä–æ–¥–∏—Ç–µ–ª—é (–∏–∑–≤–Ω–µ –∫–ª–∞—Å—Å –∫–∞–∫-–±—É–¥—Ç–æ –±—ã –Ω–µ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫)

–Ø–≤–Ω—ã–µ –∫–∞—Å—Ç—ã:

**static_cast –ø—Ä–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏**

```cpp
static_cast<B&>(d); // —Ç–µ–ø–µ—Ä—å d –∫–∞–∫-–±—É–¥—Ç–æ –±—ã Base
static_cast<B>(d); // —Å–æ–∑–¥–∞–Ω–∏–µ –∫–æ–ø–∏–∏ - Base –∏–∑ Derived

–ï—Å–ª–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–∞—Ç–Ω–æ–µ, —Ç–æ static_cast –¥–∞—Å—Ç CE.
    
Derived d;
Base& b = d;
static_cast<Derived&>(b); // –º–æ–∂–Ω–æ –¥–∞–∂–µ –≤–Ω–∏–∑, –Ω–æ –±—É–¥–µ—Ç UB, –µ—Å–ª–∏ –±—ã–ª –Ω–µ Derived, a Base
```

**reinterpret_cast –ø—Ä–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏**

–ü–æ–∑–≤–æ–ª—è–µ—Ç —Ç—É–ø–æ –≤—Å–µ (–Ω–µ —Å–º–æ—Ç—Ä–∏—Ç –Ω–∞ –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏ –∏ —Ç.–¥.), –∫—Ä–æ–º–µ –∫–∞—Å—Ç–æ–≤ –æ—Ç const –≤ –Ω–µ const. –ü—Ä–æ—Å—Ç–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –æ–¥–Ω–∏ –∫–ª–∞—Å—Å—ã –∫–∞–∫ –¥—Ä—É–≥–∏–µ. –ú–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ –∫ —Å—Å—ã–ª–∫–µ –∏ —É–∫–∞–∑–∞—Ç–µ–ª—é, –Ω–æ–≤—ã–π –æ–±—ä–µ–∫—Ç —Å–æ–∑–¥–∞—Ç—å –Ω–µ –º–æ–∂–µ—Ç

**dynamic_cast**

–û—Å—É—â–µ—Å—Ç–≤–ª—è–µ—Ç—Å—è –≤ runtime. –ï–≥–æ —É—Å–ø–µ—à–Ω–æ—Å—Ç—å –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è, –ø—Ä–∏–º–µ–Ω–∏–º —Ç–æ–ª—å–∫–æ –∫ –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–º —Ç–∏–ø–∞–º. –ï—Å–ª–∏ –Ω–µ–ª—å–∑—è –ø—Ä–∏–≤–µ—Å—Ç–∏, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç nullptr. –ú–æ–∂–Ω–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å –∫ —Å—Å—ã–ª–∫–µ –∏ —É–∫–∞–∑–∞—Ç–µ–ª—é. –û–±—ã—á–Ω–æ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –∫–∞—Å—Ç–∞ **–≤–Ω–∏–∑**.

```cpp
struct Granny {
    virtual void f();
}
struct Mother: Granny {}
struct Son: Mother {}

Mother* pm = new Mother();
std::cout << dynamic_cast<Son*>(pm); // 0 bcz cast is bad

Mother* pm = new Son();
std::cout << dynamic_cast<Son*>(pm); // ok, —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ son
```

–ö–∞—Å—Ç—ã –≤ –¥—Ä—É–≥–∏–µ –≤–µ—Ç–∫–∏ –∏  –ø—Ä–∏–º–µ—Ä —Å–∏—Ç—É–∞—Ü–∏–∏, –∫–æ–≥–¥–∞ –≤—Å–µ —Ç—Ä–∏ —ç—Ç–∏—Ö –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞ –≤–µ–¥—É—Ç —Å–µ–±—è –ø–æ-—Ä–∞–∑–Ω–æ–º—É:

```cpp
struct Granny {
    virtual void f();
}
struct Mother: Granny {}
struct Father: Granny {}
struct Son: Mother, Father {}

// –∫–∞—Å—Ç –≤–±–æ–∫
Mother* pm = new Son();
dynamic_cast<Father*>(pm); // ok
static_cast<Father*>(pm); // CE, —Ç–∏–ø—ã –Ω–µ—Å–æ–≤–º–µ—Å—Ç–∏–º—ã
reinterpret_cast<Father*>(pm); // –≤–∞—â–µ –ø–∞**—é, –Ω–æ UB
```

**dynamic cast –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç:**

- –ø—Ä–∏ –ø—Ä–∏–≤–∞—Ç–Ω–æ–º –∏ protected –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏
- –Ω–µ–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –∫–ª–∞—Å—Å—ã

–ü—Ä–∏ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –∫–∞—Å—Ç–∞ –¥–ª—è —Å—Å—ã–ª–æ–∫ –∫–∏–¥–∞–µ—Ç std::bad_cast, –¥–ª—è —É–∫–∞–∑–∞—Ç–µ–ª–µ–π - nullptr

## 12

–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –ø—Ä–∏–∑–≤–∞–Ω—ã —Ä–µ—à–∏—Ç—å —Å–ª–µ–¥—É—é—â—É—é –ø—Ä–æ–±–ª–µ–º—É:

```cpp
struct Base {
    void f() {}
    virtual void g() {} // –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
}
struct Derived : Base {
    void f() {}
    void g() override {}
}

Derived d;
Base& b = d;
b.f(); // –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ Base

b.g(); // –≤—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞ Derived
```

**–í–∏—Ä—Ç—É–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤ –°++** ‚Äî —ç—Ç–æ –æ—Å–æ–±—ã–π —Ç–∏–ø  —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä–∞—è, –ø—Ä–∏ –µ—ë –≤—ã–∑–æ–≤–µ, –≤—ã–ø–æ–ª–Ω—è–µ—Ç ¬´–Ω–∞–∏–±–æ–ª–µ–µ¬ª –¥–æ—á–µ—Ä–Ω–∏–π (—á–∞—Å—Ç–Ω—ã–π) –º–µ—Ç–æ–¥,  –∫–æ—Ç–æ—Ä—ã–π —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –º–µ–∂–¥—É —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∏–º –∏ –¥–æ—á–µ—Ä–Ω–∏–º–∏ –∫–ª–∞—Å—Å–∞–º–∏

–ö–æ–≥–¥–∞ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ —É –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–µ–º–æ–π —Ñ—É–Ω–∫—Ü–∏–∏ –æ—Ç–ª–∏—á–∞–µ—Ç—Å—è –æ—Ç –∏—Å—Ö–æ–¥–Ω–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–π, –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å —Ç—É—Ç –∂–µ –ª–æ–º–∞–µ—Ç—Å—è (–Ω–∞–ø—Ä–∏–º–µ—Ä, const –≤ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–µ –Ω–µ –±—É–¥–µ—Ç –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è—Ç—å non const virtual –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ)

–í—ã–±–æ—Ä –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Å–æ–≤–µ—Ä—à–∞–µ—Ç—Å—è –≤ runtime, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤ compile time –Ω–µ–ª—å–∑—è –ø—Ä–æ–≤–µ—Ä–∏—Ç—å, –∫–∞–∫–æ–π –æ–±—ä–µ–∫—Ç –ª–µ–∂–∏—Ç –ø–æ–¥ —Å—Å—ã–ª–∫–æ–π.

–ï—Å–ª–∏ –Ω–∞–ø–∏—Å–∞–ª–∏ override, –Ω–æ —Å–∏–≥–Ω–∞—Ç—É—Ä–∞ –Ω–µ —Å–æ–≤–ø–∞–ª–∞ —Å virtual, —Ç–æ CE

**–ü—Ä–∞–≤–∏–ª–æ: –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–∑—ã–≤–∞–π—Ç–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–µ–ª–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ –∏–ª–∏ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–≤ (–±—É–¥–µ—Ç –≤—ã–∑–≤–∞–Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–∞—è –≤–µ—Ä—Å–∏—è).**

```cpp
#include <iostream>
using namespace std;

struct A {
	private:
	virtual void f() {
		std::cout << "1";
	}
};

struct B : A {
	void f() {
		std::cout << "2";
	}
};

int main() {
	B b;
	A& a = b;
	a.f(); // CE
    // –≤—ã–±–æ—Ä –∫–∞–Ω–¥–∏–¥–∞—Ç–æ–≤ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏ –≤ –∫–ª–∞—Å—Å–µ –ê (—Å—Å—ã–ª–∫–∞ –Ω–∞ B —Å–µ–π—á–∞—Å –Ω–µ–æ—Ç–ª–∏—á–∏–º–∞ –æ—Ç –ê). –ö–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤–∏–¥–∏—Ç, —á—Ç–æ –ø—ã—Ç–∞–µ–º—Å—è –≤—ã–∑–≤–∞—Ç—å –ø—Ä–∏–≤–∞—Ç–Ω—ã–π –º–µ—Ç–æ–¥ –∏ –≤—ã–∫–∏–¥—ã–≤–∞–µ—Ç CE
	return 0;
}
```

–¢–∏–ø—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –µ—Å—Ç8 —Ö–æ—Ç8 –æ–¥–Ω–∞ –≤–∏—Ä—Ç—É–∞–ª8–Ω–∞- —Ñ—É–Ω–∫—Ü–∏- ‚Äì –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã–π —Ç–∏–ø

![image-20210623184411028](/home/h4zzkr/snap/typora/39/.config/Typora/typora-user-images/image-20210623184411028.png)

private –Ω–µ –≤—ã–∑–æ–≤–µ—Ç –°–ï

## 13

–ü—É—Å—Ç—å —É –Ω–∞—Å –µ—Å—Ç—å –≥–µ–æ–º–µ—Ç—Ä–∏—á–µ—Å–∫–∏–µ —Ñ–∏–≥—É—Ä—ã, –∏ –º—ã —Ö–æ—Ç–∏–º —Å–¥–µ–ª–∞—Ç—å –∫–ª–∞—Å—Å-—Ä–æ–¥–∏—Ç–µ–ª—å ‚Äú–§–∏–≥—É—Ä–∞‚Äù, —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å, –¥–æ–ø—É—Å—Ç–∏–º, –º–∞—Å—Å–∏–≤ ‚Äú—É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –§–∏–≥—É—Ä—É‚Äù –∏ —Ö—Ä–∞–Ω–∏—Ç—å —Ç–∞–º —Ä–∞–∑–Ω—ã–µ —Ñ–∏–≥—É—Ä—ã. –ò, –¥–æ–ø—É—Å—Ç–∏–º, –º—ã —Ö–æ—Ç–∏–º —É–º–µ—Ç—å –∏—Å–∫–∞—Ç—å –ø–ª–æ—â–∞–¥—å —Ñ–∏–≥—É—Ä. –ù–æ –Ω–µ—Ç –æ–±—â–µ–≥–æ –∞–ª–≥–æ—Ä–∏—Ç–º–∞ –ø–æ–¥—Å—á—ë—Ç–∞ –ø–ª–æ—â–∞–¥–∏ –ª—é–±–æ–π —Ñ–∏–≥—É—Ä—ã, –∫–æ—Ç–æ—Ä—ã–π –º—ã –º–æ–≥–ª–∏ –±—ã –Ω–∞–ø–∏—Å–∞—Ç—å –≤ ‚Äú–§–∏–≥—É—Ä–µ‚Äù. –ù–∞ –ø–æ–º–æ—â—å –ø—Ä–∏—Ö–æ–¥—è—Ç —á–∏—Å—Ç–æ –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏. 

–ú—ã –ø–∏—à–µ–º **virtual double** area() = 0; –≤ —Ä–æ–¥–∏—Ç–µ–ª–µ, –∏ —Ç–∞–∫–∞—è —Ñ—É–Ω–∫—Ü–∏—è *–º–æ–∂–µ—Ç –Ω–µ –∏–º–µ—Ç—å* —Ç–µ–ª–∞, –Ω–æ –µ—ë –æ–±—è–∑–∞–Ω—ã –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏. –¢–æ–≥–¥–∞ –∫–ª–∞—Å—Å-—Ä–æ–¥–∏—Ç–µ–ª—å —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è **–∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º** –∫–ª–∞—Å—Å–æ–º (—Ç–æ –µ—Å—Ç—å, –Ω–µ–ª—å–∑—è —Å–æ–∑–¥–∞—Ç—å –æ–±—ä–µ–∫—Ç —Ç–∞–∫–æ–≥–æ —Ç–∏–ø–∞), –∏ –≤—Å—è–∫–∏–π –Ω–∞—Å–ª–µ–¥–Ω–∏–∫, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç —ç—Ç—É —Ñ—É–Ω–∫—Ü–∏—é, –±—É–¥–µ—Ç —Ç–æ–∂–µ –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–º –∫–ª–∞—Å—Å–æ–º.

**virtual destructors.** –ü—Ä–µ–¥—Å—Ç–∞–≤–∏–º —Å–ª–µ–¥—É—é—â—É—é —Å–∏—Ç—É–∞—Ü–∏—é:

```cpp
// B - –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ A, –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–±—ã—á–Ω—ã–π
B* b = new B();
A* a = b;
delete a;
```

–ü—Ä–æ–∏–∑–æ–π–¥–µ—Ç —É—Ç–µ—á–∫–∞ –ø–∞–º—è—Ç–∏, –ø–æ—Ç–æ–º—É —á—Ç–æ –≤—ã–∑–æ–≤–µ—Ç—Å—è –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä A, –∏ B-—á–∞—Å—Ç—å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –Ω–µ—É–¥–∞–ª—ë–Ω–Ω–æ–π. –ü–æ—ç—Ç–æ–º—É –ø—Ä–∏ –Ω–∞—Å–ª–µ–¥–æ–≤–∞–Ω–∏–∏ –≤—Å–µ–≥–¥–∞ —Å—Ç–æ–∏—Ç –æ–±—ä—è–≤–ª—è—Ç—å // B - –Ω–∞—Å–ª–µ–¥–Ω–∏–∫ A, –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–±—ã—á–Ω—ã–π

B* b = **new** B();

A* a = b;

**delete** a; **–≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–º**, –µ—Å–ª–∏ –≤—ã —Ö–æ—Ç–∏—Ç–µ –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫—É —á–µ—Ä–µ–∑ —É–∫–∞–∑–∞—Ç–µ–ª—å –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è

**RTTI**

Runtime type information - –¥–ª—è –ø–æ–ª–∏–º–æ—Ä—Ñ–Ω—ã—Ö —Ç–∏–ø–æ–≤ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –¥–æ–ª–∂–µ–Ω —É–º–µ—Ç—å –≤—ã–±–∏—Ä–∞—Ç—å –ø—Ä–∞–≤–∏–ª—å–Ω—É—é –≤–µ—Ä—Å–∏—é. –ù–æ –≤ compile time —ç—Ç–æ —Å–¥–µ–ª–∞—Ç—å –Ω–µ–ª—å–∑—è - –Ω–µ–ª—å–∑—è –ø—Ä–µ–¥—É–≥–∞–¥–∞—Ç—å, —á—Ç–æ –±—É–¥–µ—Ç –ª–µ–∂–∞—Ç—å –ø–æ–¥ —Å—Å—ã–ª–∫–æ–π –∏–ª–∏ —É–∫–∞–∑–∞—Ç–µ–ª–µ–º.  

–≠—Ç–æ –º–µ—Ö–∞–Ω–∏–∑–º, –∫–æ—Ç–æ—Ä—ã–π –ø–æ–∑–≤–æ–ª—è–µ—Ç –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Ç–∏–ø –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –∏–ª–∏ –æ–±—ä–µ–∫—Ç–∞ –Ω–∞ —ç—Ç–∞–ø–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã.

**typeid()** - —Å–ø—Ä–æ—Å–∏—Ç—å –≤ runtime —Ç–∏–ø –æ–±—ä–µ–∫—Ç–∞, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç std::typeinfo, –∏—Ö –º–æ–∂–Ω–æ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –Ω–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ

```cpp
Son s;
Mother& m = s;
typeid(m) == typeid(s) // true
```

typeid(s).name() - –≤–µ—Ä–Ω—É—Ç—å –∏–º—è –∫–ª–∞—Å—Å–∞ –æ–±—ä–µ–∫—Ç–∞, typeid –∑–∞–º–µ–¥–ª—è–µ—Ç runtime

## 9

 **–®–∞–±–ª–æ–Ω—ã** ‚Äî —ç—Ç–æ —Å—Ä–µ–¥—Å—Ç–≤–æ —è–∑—ã–∫–∞, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –¥–ª—è –Ω–∞–ø–∏—Å–∞–Ω–∏—è –∫–æ–¥–∞ –±–µ–∑ –ø—Ä–∏–≤—è–∑–∫–∏ –∫ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–º—É —Ç–∏–ø—É.

```cpp
template <typename T>
struct remove_reference {
    typedef type T;
}

template <typename T>
void max(const T& a, const T& b) {}

max<int>(1, 2.0);
```

**–ü–µ—Ä–µ–≥—Ä—É–∑–∫–∞ —Ñ—É–Ω–∫—Ü–∏–π —Å —à–∞–±–ª–æ–Ω–Ω—ã–º–∏**

–ü—Ä–∏–º–µ—Ä –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∏ —à–∞–±–ª–æ–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π —Å —É—á–∞—Å—Ç–∏–µ–º —à–∞–±–ª–æ–Ω–Ω–æ–π –∏ –Ω–µ —à–∞–±–ª–æ–Ω–Ω–æ–π –≤–µ—Ä—Å–∏–∏

*—á–∞—Å—Ç–Ω–æ–µ –ª—É—á—à–µ –æ–±—â–µ–≥–æ*

```cpp
template <typename T>
void f(T x) {}
void f(int x) {}
f(3); //–≤—ã–±–µ—Ä–µ—Ç—Å—è –≤—Ç–æ—Ä–∞—è –≤–µ—Ä—Å–∏—è, —á–∞—Å—Ç–Ω–æ–µ –ª—É—á—à–µ –æ–±—â–µ–≥–æ
```

*—Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –ª—É—á—à–µ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤*

```cpp
#include <iostream>
using namespace std;

template <typename T, typename U>
void f(T x, U y) { std::cout << 1; }

template <typename T>
void f(T x, T y) { std::cout << 2; }

void f(int x, double y) { std::cout << 3; }

int main() {
	f(0, 0); // 2
    f(0.5, 0) // 1
	return 0;
}
```

–®–∞–±–ª–æ–Ω–Ω–∞—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –ø–æ —Å—Å—ã–ª–∫–µ –∏ –ø–æ –∑–Ω–∞—á–µ–Ω–∏—é - CE, –Ω–æ

```cpp
template <typename T>
void f(T& x) {}

template <typename T>
void f(const T& x) {}

int x = 0;
int& y = x;
f(y); // –≤—ã–±–µ—Ä–µ—Ç—Å—è –ø–µ—Ä–≤–∞—è –≤–µ—Ä—Å–∏—è (–Ω–µ –Ω—É–∂–µ–Ω –∫–∞—Å—Ç)
```

## 10

**–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —à–∞–±–ª–æ–Ω–æ–≤** –Ω—É–∂–Ω—ã –¥–ª—è —Å–ª—É—á–∞–µ–≤, –∫–æ–≥–¥–∞ –º—ã —Ö–æ—Ç–∏–º, —á—Ç–æ–±—ã —Å –¥–∞–Ω–Ω—ã–º –Ω–∞–±–æ—Ä–æ–º —Ç–∏–ø–æ–≤ –¥–∞–Ω–Ω—ã—Ö —Ñ—É–Ω–∫—Ü–∏—è –≤–µ–ª–∞ —Å–µ–±—è –ø–æ-–¥—Ä—É–≥–æ–º—É (—Ç.–µ. –∫–∞–∫-—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω–æ).

```cpp
template<typename T>
struct remove_ref {
   typedef T type;
};
 
// —á–∞—Å—Ç–∏—á–Ω–∞—è
template<typename T>
struct remove_ref<T&> {
   typedef T type;
};
 
// —á–∞—Å—Ç–∏—á–Ω–∞—è (–∞ —Ç–∞–∫–∂–µ –¥–ª—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç, —É–∫–∞–∑–∞—Ç–µ–ª–µ–π, –º–∞—Å—Å–∏–≤–æ–≤)
template<typename T>
struct remove_ref<T&&> {
   typedef T type;
};

// –ø–æ–ª–Ω–∞—è
template<>
struct remove_ref<int> {
    typedef int type; // useless
}
```

**–ß–∞—Å—Ç–∏—á–Ω–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —à–∞–±–ª–æ–Ω–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤—ã–ø–æ–ª–Ω–∏—Ç—å  —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—é —à–∞–±–ª–æ–Ω–∞ –∫–ª–∞—Å—Å–∞ (–Ω–æ –Ω–µ —Ñ—É–Ω–∫—Ü–∏–∏!), –≥–¥–µ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ (–Ω–æ –Ω–µ –≤—Å–µ) –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —à–∞–±–ª–æ–Ω–∞ —è–≤–Ω–æ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω—ã**.

```cpp
// –®–∞–±–ª–æ–Ω —Ñ—É–Ω–∫—Ü–∏–∏ print() —Å —á–∞—Å—Ç–∏—á–Ω–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º —à–∞–±–ª–æ–Ω–æ–º –∫–ª–∞—Å—Å–∞ StaticArray<char, size> –≤ –∫–∞—á–µ—Å—Ç–≤–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
template <int size> // size –ø–æ-–ø—Ä–µ–∂–Ω–µ–º—É —è–≤–ª—è–µ—Ç—Å—è non-type –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º
void print(StaticArray<char, size> &array) // –º—ã –∑–¥–µ—Å—å —è–≤–Ω–æ —É–∫–∞–∑—ã–≤–∞–µ–º —Ç–∏–ø char
{
	for (int count = 0; count < size; ++count)
		std::cout << array[count];
}
```



–ë–µ–∑ –∏—Å—Ö–æ–¥–Ω–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–µ –±—É–¥–µ—Ç (–Ω—É–∂–Ω–æ —Å–æ–±–ª—é–¥–∞—Ç—å —Å–∏–≥–Ω–∞—Ç—É—Ä—É —à–∞–±–ª–æ–Ω–æ–≤). –ö–ª–∞—Å—Å—ã –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å –Ω–µ–ª—å–∑—è, –¥–ª—è –Ω–∏—Ö —Ç–æ–ª—å–∫–æ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏.

–£ —Ñ—É–Ω–∫—Ü–∏–π —á–∞—Å—Ç–∏—á–Ω–∞—è —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–µ—â–µ–Ω–∞.

**–†–∞–∑–Ω–∏—Ü–∞**

–°–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Ä–æ–¥–∏—Ç–µ–ª—å—Å–∫–æ–≥–æ —à–∞–±–ª–æ–Ω–∞ –∏ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ —Ç–æ–≥–æ, –∫–∞–∫ –≤—ã–±—Ä–∞–Ω–∞ –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞.

```cpp
template <typename T, typename U>
void f(T, U) { std::cout << 1; }

template <> // —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç T, U
void f(int, int) { std::cout << 3; }

template <typename T>
void f(T, T) { std::cout << 2; }

f(0, 0); // –≤—ã–±–µ—Ä–µ—Ç—Å—è 2, —Ç.–∫. —Å–Ω–∞—á–∞–ª–∞ —Ä–∞–∑—Ä–µ—à–∏—Ç—Å—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ (—á–∞—Å—Ç–Ω–æ–µ –ª—É—á—à–µ –æ–±—â–µ–≥–æ)
```

**std:is_same**

```cpp
template<class T, class U>
struct is_same : std::false_type {};
 
template<class T>
struct is_same<T, T> : std::true_type {};
```

## 15

–í runtime –º–æ–∂–µ—Ç –ø–æ–π—Ç–∏ —á—Ç–æ-—Ç–æ –Ω–µ —Ç–∞–∫. –ö–∞–∫ —ç—Ç–æ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç? –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –Ω–µ–¥–æ–ø—É—Å—Ç–∏–º–∞—è –æ–ø–µ—Ä–∞—Ü–∏—è, –ø—Ä–æ–≥—Ä–∞–º–º–∞ –≤—ã–ª–µ—Ç–∞–µ—Ç —Å –æ—à–∏–±–∫–æ–π (exceptions). –ú—ã –∂–µ —Ö–æ—Ç–∏–º —ç—Ç—É –æ–ø–µ—Ä–∞—Ü–∏—é –æ—Ç–ª–æ–≤–∏—Ç—å (—Å–¥–µ–ª–∞—Ç—å —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –Ω–∞ —Ç–æ—Ç —Å–ª—É—á–∞–π, –µ—Å–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∞ –¥–∞—Å—Ç –æ—à–∏–±–∫—É). –ü—Ä–æ–≥—Ä–∞–º–º–∞ –ø—Ä–∏ —ç—Ç–æ–º –Ω–µ –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è.

Terminate - –∞–≤–∞—Ä–∏–π–Ω–æ–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä –∫–æ–≥–¥–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ –Ω–∏–≥–¥–µ –Ω–µ –ø–æ–π–º–∞–ª–∏.

**–ù–µ–¥–æ—Å—Ç–∞—Ç–∫–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π:**

- try –ª–æ–≤–∏—Ç —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –±—ã–ª–æ –±—Ä–æ—à–µ–Ω–æ —Å –ø–æ–º–æ—â—å—é throw. –¢.–µ. –Ω–µ–ª—å–∑—è –æ—Ç—Å–ª–µ–¥–∏—Ç—å UB, –±–∏—Ç—ã–µ —Å—Å—ã–ª–∫–∏ –∏ —Ç.–ø. –ù–µ–ª—å–∑—è –ª–æ–≤–∏—Ç—å RE - –Ω–µ –∫–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ - –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.
- –ø—Ä–∏ –≤—ã–∑–æ–≤–µ throw –º—ã –ø—Ä–µ–∫—Ä–∞—â–∞–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –∫–æ–¥–∞, –ø–æ—ç—Ç–æ–º—É –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –º–æ–≥—É—Ç –±—ã—Ç—å –Ω–µ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã
- –∏—Å–∫–ª—é—á–µ–Ω–∏—è –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö
- –º–æ–≥—É—Ç –∑–∞–º–µ–¥–ª–∏—Ç—å (–Ω–µ–Ω–∞–º–Ω–æ–≥–æ) –∫–æ–¥
- —É—Å–ª–æ–∂–Ω—è—é—Ç –Ω–∞–ø–∏—Å–∞–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫:
- –Ω—É–∂–Ω–æ –ø–æ–º–Ω–∏—Ç—å –ø—Ä–æ noexcept

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**

- –ø–æ–≤—ã—à–∞—é—Ç –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç—å –∫–æ–¥–∞
- –º–µ—Ö–∞–Ω–∏–∑–º –ø–µ—Ä–µ–¥–∞—á–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤–≤–µ—Ä—Ö –ø–æ –≤–ª–æ–∂–µ–Ω–Ω—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º
- –ø–æ–∑–≤–æ–ª—è—é—Ç –Ω–µ –ø—Ä–µ–∫—Ä–∞—â–∞—Ç—å —Ä–∞–±–æ—Ç—É –≤ —Å–ª—É—á–∞–µ –∫–∞–∫–∏—Ö-—Ç–æ –æ—à–∏–±–æ–∫

**–ö–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π**

```cpp
void f() {
    Noisy x;
    throw x; // —É–Ω–∏—á—Ç–æ–∂–∞–µ—Ç—Å—è, –ø–æ—ç—Ç–æ–º—É –ø—Ä–∏ –≤—ã—Ö–æ–¥–µ —Å–æ–∑–¥–∞–µ—Ç—Å—è –∫–æ–ø–∏—è
}

int main() {
    try {
        f();
    } catch (const Noisy& x) { // –ø–æ–π–º–∞–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ –∫–æ–ø–∏—é
        // –±–µ–∑ const & –±—É–¥–µ—Ç –æ–ø—è—Ç—å –∫–æ–ø–∏—è
        std::cout << "caught";
    }
}
```

**throw –∏ throw ex**

```cpp
void g() {
    try {
        throw std::out_of_range("a");
    } catch (const std::exception& ex) {
        // –ø–æ–π–º–∞–ª–∏ –ø–æ —Å—Å—ã–ª–∫–µ –Ω–∞ —Ä–æ–¥–∏—Ç–µ–ª—è
        throw; // –ø–µ—Ä–µ–¥–∞—Ç—å std::out_of_range –≤–≤–µ—Ä—Ö
        // throw ex; // –±—Ä–æ—Å–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π –µ—â–µ —Ä–∞–∑, —Ç.–µ. —Å–∫–æ–ø–∏—Ä—É–µ–º –∫–∞–∫ –Ω–æ–≤–æ–µ std::exception, —Å—Ç–∞—Ä–æ–µ —É–Ω–∏—á—Ç–æ–∂–∏—Ç—Å—è
    }
}

void exit() {
    throw; // —Å—Ä–∞–∑—É –ø–æ–ª—É—á–∏–º terminate, –Ω–µ–ª—å–∑—è –Ω–∏–∫–∞–∫ –Ω–∏—á–µ–≥–æ –ø–æ–π–º–∞—Ç—å
}

int main() {
    try {
        g();
    } catch (std::out_of_range& oor) {
        std::cout << "caught2"; // –ø–æ–π–º–∞–µ–º –Ω—É–∂–Ω–æ–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ
    }
}
```

**–ø—Ä–∞–≤–∏–ª–∞ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è —Ç–∏–ø–æ–≤**

–Ω–µ –¥–µ–π—Å—Ç–≤—É–µ—Ç –ø—Ä–∏–≤–µ–¥–µ–Ω–∏–µ —Ç–∏–ø–æ–≤ (–¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è), –∑–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ–º —Å–∏—Ç—É–∞—Ü–∏–∏ –ø—Ä–∏–≤–µ–¥–µ–Ω–∏—è –º–µ–∂–¥—É —Ä–æ–¥–∏—Ç–µ–ª–µ–º –∏ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–æ–º –∏ const/non cost

**–ü—Ä–∞–≤–∏–ª–∞ –≤—ã–±–æ—Ä–∞ –ø–æ–¥—Ö–æ–¥—è—â–µ–π —Å–µ–∫—Ü–∏–∏ catch**

–ü—Ä–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö catch –ø–æ–¥—Ä—è–¥ –≤—ã–±–∏—Ä–∞–µ—Ç—Å—è –ø–µ—Ä–≤—ã–π –ø–æ–¥—Ö–æ–¥—è—â–∏–π

## 16

–ï—Å–ª–∏ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –æ–±—ä–µ–∫—Ç–∞ –≤—ã–∫–∏–Ω—É–ª –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, —Ç–æ –æ–±—ä–µ–∫—Ç —Å—á–∏—Ç–∞–µ—Ç—Å—è –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ —Å–æ–∑–¥–∞–Ω–Ω—ã–º, —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ –æ—Ç –Ω–µ–≥–æ –Ω–µ–ª—å–∑—è –≤—ã–∑–≤–∞—Ç—å –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä (–∏–Ω–∞—á–µ –≤–æ–∑–Ω–∏–∫–∞–ª–æ –±—ã UB), –∞ –∑–Ω–∞—á–∏—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–∏–∑–æ–π—Ç–∏ —É—Ç–µ—á–∫–∞ —Ä–µ—Å—É—Ä—Å–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –±—ã–ª–∏ –≤—ã–¥–µ–ª–µ–Ω—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–æ–º –¥–æ —Ç–æ–≥–æ, –∫–∞–∫ –±—ã–ª–æ –≤—ã–∫–∏–Ω—É—Ç–æ –∏—Å–∫–ª—é—á–µ–Ω–∏–µ.

–î–ª—è —Ä–µ—à–µ–Ω–∏—è —Ç–∞–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –Ω—É–∂–Ω—ã —É–º–Ω—ã–µ —É–∫–∞–∑–∞—Ç–µ–ª–∏. –¢–æ–≥–¥–∞ –ø—Ä–∏ –∞–≤–∞—Ä–∏–π–Ω–æ–º –≤—ã—Ö–æ–¥–µ –≤—ã–∑–æ–≤–µ—Ç—Å—è –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä —É–º–Ω–æ–≥–æ —É–∫–∞–∑–∞—Ç–µ–ª—è –∏ —Ä–µ—Å—É—Ä—Å –±—É–¥–µ—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω.

**–ò–¥–∏–æ–º–∞ RAII - Resourse Acquisition Is Inizialization** - –∑–∞—Ö–≤–∞—Ç —Ä–µ—Å—É—Ä—Å–∞ –µ—Å—Ç—å –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –Ω–µ–∫–æ—Ç–æ—Ä–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞. –í—Å—è–∫–∏–π —Ä–∞–∑, –∫–æ–≥–¥–∞ –Ω—É–∂–Ω–æ –∑–∞—Ö–≤–∞—Ç–∏—Ç—å –∫–∞–∫–æ–π-—Ç–æ —Ä–µ—Å—É—Ä—Å, —ç—Ç–æ –¥–µ–ª–∞–µ–º –Ω–µ –ª–æ–±, –∞ —Å –ø–æ–º–æ—â—å—é –æ–±—ä–µ–∫—Ç–∞, –∫–æ—Ç–æ—Ä—ã–π —è–≤–Ω–æ —ç—Ç–æ –¥–µ–ª–∞–µ—Ç. –¢–æ–≥–¥–∞ –∫–∞–∂–¥—ã–π —Ä–∞–∑ –∫–æ–≥–¥–∞ –±—É–¥–µ—Ç –≤—ã–±—Ä–∞—Å—ã–≤–∞—Ç—å—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä –ª–æ–∫–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–∫—Ç–æ–≤ –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ –≤—ã–∑–æ–≤—É—Ç—Å—è –∏ —Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ —Ä–µ—Å—É—Ä—Å—ã –±—É–¥—É—Ç –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω—ã –≤–æ–≤—Ä–µ–º—è.

**–ò—Å–∫–ª—é—á–µ–Ω–∏—è –≤ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞—Ö**

*–Ø–∑—ã–∫ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫—É  –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –∏—Å–∫–ª—é—á–µ–Ω–∏–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ*, –ø–æ—ç—Ç–æ–º—É –º–æ–≥—É—Ç –≤–æ–∑–Ω–∏–∫–∞—Ç—å –Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–µ —Å–∏—Ç—É–∞—Ü–∏–∏:

```cpp
void g() {
    Dangerous a;
}

void f() {
    Dangerous b;
    g();
    // exception on g
    // exception on b
    // => TERMINATE
}
```

–ü–æ—ç—Ç–æ–º—É –≤—Å–µ –¥–µ—Å—Ç—Ä—É–∫—Ç–æ—Ä—ã —Å—á–∏—Ç–∞—é—Ç—Å—è noexcept.

**–°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏—Å–∫–ª—é—á–µ–Ω–∏–π**

- –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—â–∏–µ –∏—Å–∫–ª—é—á–µ–Ω–∏–π
- –µ—Å—Ç—å —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –≤—ã–±—Ä–∞—Å—ã–≤–∞—é—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è

C C++11 –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —É–∫–∞–∑–∞—Ç—å –≤ —Å–∏–≥–Ω–∞—Ç—É—Ä–µ, –∫–∏–¥–∞–µ—Ç –ª–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω–æ —Ñ—É–Ω–∫—Ü–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ —Å –ø–æ–º–æ—â—å—é –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ noexcept. –≠—Ç–æ –æ–±–µ—â–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–µ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä–æ–º. –ï—Å–ª–∏ —Ñ—É–Ω–∫—Ü–∏—è, –æ—Ç–º–µ—á–µ–Ω–Ω–∞—è noexcept –≤—ã–∫–∏–Ω–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏–µ, —Ç–æ –ø—Ä–æ–≥—Ä–∞–º–º–∞ —Å—Ä–∞–∑—É –∑–∞–≤–µ—Ä—à–∏—Ç—Å—è –≤—ã–∑–æ–≤–æ–º terminate (–Ω–æ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤—ã–¥–∞—Å—Ç Warning)

``` 
noexcept(true) - –Ω–µ –≤—ã–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∏—Å–∫–ª—é—á–µ–Ω–∏—è
```

```cpp
void function() noexcept(true) {} // —Å–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ç–æ—Ä noexcept, –º–± —É—Å–ª–æ–≤–Ω—ã–º (—Å–æ–¥–µ—Ä–∂–∞—Ç—å —É—Å–ª–æ–≤–∏–µ)
// noexcept(expression) - –æ–ø–µ—Ä–∞—Ç–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç true, –µ—Å–ª–∏ –≤—ã—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤, –ø—Ä–∏–≤–æ–¥—è—â–∏—Ö –∫ –∏—Å–∫–ª—é—á–µ–Ω–∏—é:
// throw, new, dynamic_cast, no noexcept function
```

noexcept(1 / 0) - true, –Ω–µ –≤—ã—á–∏—Å–ª—è–µ—Ç—Å—è –≤ compile time, –∞ –ø—Ä–æ—Å—Ç–æ –æ—Ü–µ–Ω–∏–≤–∞–µ—Ç—Å—è

## 17

–û–ø–µ—Ä–∞—Ç–æ—Ä new - –¥–æ–≤–æ–ª—å–Ω–æ –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è –∞–±—Å—Ç—Ä–∞–∫—Ü–∏—è, –ø–æ—ç—Ç–æ–º—É —á—Ç–æ–±—ã —Ä–∞–±–æ—Ç–∞—Ç—å –Ω–∞ –±–æ–ª–µ–µ –≤—ã—Å–æ–∫–æ–º —É—Ä–æ–≤–Ω–µ, –Ω–∞ —É—Ä–æ–≤–Ω–µ —è–∑—ã–∫–∞ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –∞ –Ω–µ –Ω–∞ —É—Ä–æ–≤–Ω–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã, –ø—Ä–∏–¥—É–º–∞–ª–∏ –≤—ã–¥–µ–ª—è—Ç—å –∏ –≤–ª–∞–¥–µ—Ç—å –ø–∞–º—è—Ç—å—é –≤ –≤–∏–¥–µ –∫–ª–∞—Å—Å–∞.

```cpp
template <typename T>
struct allocator {
    T* allocate(size_t n) {
        return ::operator new(n * sizeof(T));
    }
    
    void deallocate(T* ptr, size_t n) {
        ::operator delete(ptr);
    }
    
    template <typename... Args>
    void construct(T* ptr, const Args&... args) {
        new (ptr) T(args...);
    }
    
    void destroy(T* ptr) {
        ptr->~T();
    }
};
```

**placement new** - –Ω–∞–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –Ω–∞ —É–∂–µ –≤—ã–¥–µ–ª–µ–Ω–Ω—É—é –ø–æ —É–∫–∞–∑–∞—Ç–µ–ª—é –ø–∞–º—è—Ç—å. –°–æ–±—Å—Ç–≤–µ–Ω–Ω–æ, –ø–æ—Ç–æ–º –ø—Ä–∏–¥–µ—Ç—Å—è –≤—Ä—É—á–Ω—É—é —Ä–∞–∑—Ä—É—à–∞—Ç—å –æ–±—ä–µ–∫—Ç –∏ —á–∏—Å—Ç–∏—Ç—å –ø–∞–º—è—Ç—å —Å –ø–æ–º–æ—â—å—é ::operator delete(ptr)

–û—Ç–ª–∏—á–∏–µ –æ—Ç new –≤ —Ç–æ–º, —á—Ç–æ new –≤—ã–¥–µ–ª—è–µ—Ç –ø–∞–º—è—Ç—å –∏ —Å—Ä–∞–∑—É –∂–µ –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä—É–µ—Ç –Ω–∞ –Ω–µ–π –æ–±—ä–µ–∫—Ç.

**allocator_traits** - –°–æ–∑–¥–∞–Ω –¥–ª—è —Ç–æ–≥–æ, —á—Ç–æ–±—ã –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –≤–µ—â–∏ –¥–æ–æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –∑–∞ –≤–∞—Å, —Ç–∞–∫ –∫–∞–∫ –Ω–µ–∫–æ—Ç–æ—Ä—ã–µ –º–µ—Ç–æ–¥—ã –≤ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏ –≤—Å–µ—Ö –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–∞—Ö –¥–µ–ª–∞—é—Ç –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ. https://docs.microsoft.com/en-gb/cpp/standard-library/allocator-traits-class?view=msvc-160

**rebind** - –Ω—É–∂–µ–Ω –¥–ª—è –ø–æ–¥–º–µ–Ω—ã —Ç–∏–ø–∞, –≤—ã–¥–µ–ª—è–µ–º–æ–≥–æ –Ω–∞ –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤ list –Ω—É–∂–Ω–æ –∞–ª–ª–æ—Ü–∏—Ä–æ–≤–∞—Ç—å Node, –∞ –Ω–µ —Ç–∏–ø –¢:

```cpp
template <typename T, typename Alloc = std::allocator<T>>
class list {
    struct Node {...};
    ...;
    std::allocator_traits<Alloc>::rebind_alloc<Node> alloc;
    
public:
    list(const Alloc& alloc = Alloc()) : alloc(alloc) {}
    	
};

template<typename U> struct rebind { typedef FastAllocator<U> other; };
```

–ò–∑–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –ø–æ–ª—É—á–∞–µ–º –∞–ª–ª–æ–∫–∞—Ç–æ—Ä –¥–ª—è –¥—Ä—É–≥–æ–≥–æ —Ç–∏–ø–∞.



## 18

**–ò—Ç–µ—Ä–∞—Ç–æ—Ä—ã** - —Å—É—â–Ω–æ—Å—Ç–∏ –∫–æ—Ç–æ—Ä—ã–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –ø–µ—Ä–µ—á–∏—Å–ª—è—Ç—å —ç–ª–µ–º–µ–Ω—Ç—ã –Ω–µ–∫–æ—Ç–æ—Ä–æ–π –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å-
–Ω–æ—Å—Ç–∏. –¢–æ —á—Ç–æ –≤–µ–¥–µ—Ç –∫–∞–∫ –∏—Ç–µ—Ä–∞—Ç–æ—Ä –∏ –µ—Å—Ç—å –∏—Ç–µ—Ä–∞—Ç–æ—Ä. –í–µ—Å—Ç–∏ —Å–µ–±—è –∫–∞–∫ –∏—Ç–µ—Ä–∞—Ç–æ—Ä - –ø–æ–∑–≤–æ–ª—è—Ç—å —Å–µ–±—è
—Ä–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞—Ç—å, –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å –∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –Ω–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–æ.

**Const iterator** - –Ω–µ –ø–æ–∑–≤–æ–ª—è—é—Ç –º–µ–Ω—è—Ç—å –æ–±—ä–µ–∫—Ç –ø–æ–¥ —Å–æ–±–æ–π. –†–∞–∑—ã–º–µ–Ω–æ–≤—ã–≤–∞—è —Ç–∞–∫–æ–π –∏—Ç–µ—Ä–∞—Ç–æ—Ä,
–ø–æ–ª—É—á–∞–µ–º —Å—Å—ã–ª–∫—É –Ω–∞ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–π –æ–±—ä–µ–∫—Ç. –ö–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–º—É –∏—Ç–µ—Ä–∞—Ç–æ—Ä—É –º–æ–∂–Ω–æ –ø—Ä–∏—Å–≤–æ–∏—Ç—å –æ–±—ã—á-
–Ω—ã–π, –Ω–æ –Ω–µ –Ω–∞–æ–±–æ—Ä–æ—Ç

*std::conditional_t*<bool_value, type_one, type_two> - rovides member typedef `type`, which is defined as `type_one` if is true at compile time, or as `type_two` if `B` is false.

**–∏—Ç–µ—Ä–∞—Ç–æ—Ä –Ω–∞–¥ List –±–µ–∑ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–¥–∞**

```cpp
/// START OF ITERATOR ///
#include <iterator>

template<bool IsConst>
struct common_iterator {
public:
    // for iterator_traits
    using difference_type       = std::ptrdiff_t;
    using value_type            = T;
    using pointer               = typename std::conditional_t<IsConst, const T *, T*>;
    using reference             = typename std::conditional_t<IsConst, const T &, T&>;
    using iterator_category     = std::bidirectional_iterator_tag;

private:
    friend List;
    Node* ptr;
    common_iterator(Node* ptr) : ptr(ptr) {}

public:
    common_iterator() = default;
    common_iterator(const common_iterator &it) : ptr(it.ptr) {}
    common_iterator &operator=(const common_iterator &other) {
        ptr = other.ptr;
        return *this;
    }
    pointer operator->() { return &ptr->value; }
    reference operator*() { return ptr->value; }
    common_iterator &operator++() {
        ptr = ptr->next;
        return *this;
    }
    common_iterator &operator--() {
        ptr = ptr->prev;
        return *this;
    }
    common_iterator operator++(int) {
        common_iterator iter(*this);
        ++(*this);
        return iter;
    }
    common_iterator operator--(int) {
        common_iterator iter(*this);
        --(*this);
        return iter;
    }
    common_iterator &operator+=(size_t shift) {
        for (size_t i = 0; i < shift; ++i)
            ptr = ptr->next;
        return *this;
    }
    common_iterator &operator-=(size_t shift) {
        for (size_t i = 0; i < shift; ++i)
            ptr = ptr->prev;
        return *this;
    }
    common_iterator operator+(size_t shift) {
        common_iterator n(*this);
        n += shift;
        return n;
    }

    common_iterator operator-(size_t shift) {
        common_iterator n(*this);
        n -= shift;
        return n;
    }
    bool operator==(const common_iterator &it) const { return (ptr == it.ptr); }
    bool operator<(const common_iterator &rhs) const { return ptr < rhs.ptr; }
    bool operator<=(const common_iterator &rhs) const { return !(*this > rhs); }
};

using iterator                  = common_iterator<false>;
using const_iterator            = common_iterator<true>;

iterator begin() { return iterator(afterfront->next); }}
iterator end() { return iterator(afterback); }
const_iterator cbegin() const { return const_iterator(afterfront->next); }
const_iterator cend() const { return const_iterator(afterback); }
/// END OF ITERATOR ///
```

## 19

–§—É–Ω–∫—Ü–∏—è **std::advance** –ø–µ—Ä–µ–º–µ—â–∞–µ—Ç –∏—Ç–µ—Ä–∞—Ç–æ—Ä –Ω–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ —á–∏—Å–ª–æ –ø–æ–∑–∏—Ü–∏–π –≤–ø–µ—Ä–µ–¥, –Ω–∏—á–µ–≥–æ
–Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç, **std::distance** –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –¥–≤—É–º—è –∏—Ç–µ—Ä–∞—Ç–æ—Ä–∞–º–∏. –ï—Å–ª–∏ –≤—Ç–æ—Ä–æ–π
–∏—Ç–µ—Ä–∞—Ç–æ—Ä –Ω–µ–¥–æ—Å—Ç–∏–∂–∏–º –æ—Ç –ø–µ—Ä–≤–æ–≥–æ, —Ç–æ –ø–æ–≤–µ–¥–µ–Ω–∏–µ std::distance –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–æ.

```cpp
std::list<int> l1 = {1, 2, 3, 4};auto it = l1.begin();std::advance(it, 2);std::distance(l1.begin(), l1.end());
```

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è std::advance**

```cpp
// 1 version

template <typename iterator>
void my_advance(iterator& iter, size_t n) {
    if constexpr (std::is_same_v<typename std::iterator_traits<iterator>::iterator_category, std::random_access_iterator_tag>) {
        iter += n;
        std::cout << 1;
    } else {
        for (int i = 0; i < n; ++i, ++iter);
    }
} // –±–µ–∑ constexpr –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –±—ã —Ä—É–≥–∞–ª—Å—è –Ω–∞ iter+=n –¥–ª—è –Ω–µ random_access

// 2 version
template <typename iterator, typename itercat>
void advance_helper(iterator& iter, int n, itercat) {
    for (int i = 0; i < n; ++i, ++iter); // all but not RA
}

template <typename iterator>
void advance_helper(iterator& iter, int n, std::random_access_iterator_tag) {
    iter += n;
}

template <typename iterator>
void my_advance(iterator& iter, size_t n) {
    advance_helper(iter, n, typename std::iterator_traits<iterator>::iterator_category());
}
```

## 20 - 21—Ö–æ—Ä

**–§–æ—Ä–º–∞–ª—å–Ω–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ lvalue, rvalue**

–í–∞–∂–Ω–æ: 

- rvalue –∏ lvalue - –≤–∏–¥—ã –≤—ã—Ä–∞–∂–µ–Ω–∏–π, –Ω–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏ –Ω–µ —Ç–∏–ø–æ–≤

- Rvalue —Å—Å—ã–ª–∫–∞ –¥–∞–ª–µ–∫–æ –Ω–µ –≤—Å–µ–≥–¥–∞ rvalue, –∫–∞–∫ –∏ lvalue —Å—Å—ã–ª–∫–∞ –Ω–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ lvalue, —Ç–æ –µ—Å—Ç—å ùëôùë£ùëéùëôùë¢ùëí&ùëüùë£ùëéùëôùë¢ùëí —ç—Ç–æ –≤–∏–¥—ã –≤—ã—Ä–∞–∂–µ–Ω–∏–π (—Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∞—è –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è, —Å–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–∞—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, –ª–∏—Ç–µ—Ä–∞–ª–æ–≤ –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä–æ–≤), –∞ –Ω–µ –æ–±—ä–µ–∫—Ç–æ–≤ –∏–ª–∏ —Ç–∏–ø–æ–≤.

–ò–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ rvalue - –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç –∏–∑ —Å–µ–±—è —Å–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞ (—Ç–æ, —á—Ç–æ –Ω–µ –º–æ–∂–µ—Ç —Å—Ç–æ—è—Ç—å —Å–ª–µ–≤–∞ –æ—Ç –∑–Ω–∞–∫–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞). –ê lvalue - –≤—ã—Ä–∞–∂–µ–Ω–∏–µ, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è—é—â–µ–µ –∏–∑ —Å–µ–±—è –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–º—É –æ–±—ä–µ–∫—Ç—É (—Ç–æ, —á—Ç–æ –º–æ–∂–µ—Ç —Å—Ç–æ—è—Ç—å —Å–ª–µ–≤–∞ –æ—Ç –∑–Ω–∞–∫–∞ —Ä–∞–≤–µ–Ω—Å—Ç–≤–∞). –ö –¥–∞–Ω–Ω—ã–º –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è–º –µ—Å—Ç—å –∫–æ–Ω—Ç—Ä–ø—Ä–∏–º–µ—Ä—ã, —ç—Ç–æ –Ω–µ –≤—Å–µ–æ–±—ä–µ–º–ª—é—â–µ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ.

**–ü—Ä–∏–º–µ—Ä—ã, –∫–æ–≥–¥–∞ rvalue-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏–µ –∏ –∫–æ–≥–¥–∞ lvalue –Ω–µ –¥–æ–ø—É—Å–∫–∞–µ—Ç**

Const objects - —ç—Ç–æ lvalue, –Ω–æ –∏–º –ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å –Ω–µ–ª—å–∑—è, –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ
–æ–±—ä–µ–∫—Ç—ã, —É –∫–æ—Ç–æ—Ä—ã—Ö –Ω–µ –æ–ø—Ä–µ–¥–µ–ª—ë–Ω –æ–ø–µ—Ä–∞—Ç–æ—Ä –ø—Ä–∏—Å–≤–∞–∏–≤–∞–Ω–∏—è. 

–ü—Ä–æ—Ç–∏–≤–æ–ø–æ–ª–æ–∂–Ω—ã–π –ø—Ä–∏–º–µ—Ä, –∫–æ–≥–¥–∞ –º—ã –¥–µ–ª–∞–µ–º –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ ùë£ùëíùëêùë°ùëúùëü < ùëèùëúùëúùëô > —Å –ø–æ–º–æ—â—å—é [], –º—ã –ø–æ–ª—É—á–∞–µ–º –Ω–µ —Å—Å—ã–ª–∫—É, –∞ –≤—Ä–µ–º–µ–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç BitReference, –∫ –∫–æ—Ç–æ—Ä–æ–º—É –º—ã –∏ –¥–æ–ª–∂–Ω—ã –ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å, —á—Ç–æ–±—ã –∏–∑–º–µ–Ω–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ.

*Type&& - rvalue reference, type& - lvalue reference*

**Expressions:**

- lvalue:
  - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã (–∏–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π)
  - –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã =, (+-*/)= –Ω–∞–¥ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–º–∏ —Ç–∏–ø–∞–º–∏
  - prefix ++ -- on standart types
  - —É–Ω–∞—Ä–Ω–∞—è *
  - result of ?: if both operands are lvalue
  - result of ",", if right operand is lvalue
  - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ (–∏–ª–∏ –º–µ—Ç–æ–¥–∞ –∏–ª–∏ custom operator call), –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø - lvalue-reference
  - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞—Å—Ç–∞, –µ—Å–ª–∏ result-type is lvalue-reference
- rvalue:
  - *prvalue - pure rvalue*
    - –ª–∏—Ç–µ—Ä–∞–ª—ã (5, 3.0f)
    - –±–∏–Ω–∞—Ä–Ω—ã–µ –æ–ø–µ—Ä–∞—Ç–æ—Ä—ã +, -, *, /, % etc –Ω–∞–¥ –ø—Ä–∏–º–∏—Ç–∏–≤–Ω—ã–º–∏
    - postfix ++ --
    - —É–Ω–∞—Ä–Ω—ã–π &, +, -
    - result of ?: if both are rvalue
    - result of "," if right operand is rvalue
    - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ (–∏–ª–∏ –º–µ—Ç–æ–¥–∞ –∏–ª–∏ custom operator call), –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø - –Ω–µ —Å—Å—ã–ª–∫–∞
    - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞—Å—Ç–∞, –µ—Å–ª–∏ result-type is not lvalue-reference
  - *xvalue - expired value*
    - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–∑–æ–≤–∞ —Ñ—É–Ω–∫—Ü–∏–∏ (–∏–ª–∏ –º–µ—Ç–æ–¥–∞ –∏–ª–∏ custom operator call), –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—ã–π —Ç–∏–ø - —ç—Ç–æ rvalue-reference
    - —Ä–µ–∑—É–ª—å—Ç–∞—Ç –∫–∞—Å—Ç–∞, –µ—Å–ª–∏ result-type is rvalue-reference

–¢–æ–≥–¥–∞ rvalue-reference –≤–µ–¥–µ—Ç —Å–µ–±—è –∫–∞–∫ –æ–±—ã—á–Ω–∞—è —Å—Å—ã–ª–∫–∞, –Ω–æ –µ–µ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–µ —Å—á–∏—Ç–∞–µ—Ç—Å—è –∫–∞–∫ rvalue expression

**–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è rvalue —Å—Å—ã–ª–æ–∫**

```cpp
int x = 0;
int& rx = x; // ok
const int& crx = 2;

// rvalue —Å—Å—ã–ª–∫–∏ –º–æ–∂–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ—Ç rvalue
int&& rrx = x; // wrong

int&& rrx = 1; // ok, –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∂–∏–∑–Ω–∏ –æ–±—ä–µ–∫—Ç–∞
rrx = x; // ok —Ç–æ, —á—Ç–æ –ø–æ–¥ —Å—Å—ã–ª–∫–æ–π, —Ç–µ–ø–µ—Ä—å 0

x = 3; // –Ω–æ rrx –≤—Å–µ —Ä–∞–≤–Ω–æ 0, —Å—Å—ã–ª–∫–∏ –Ω–µ–ª—å–∑—è –ø–µ—Ä–µ–ø—Ä–∏—Å–≤–∞–∏–≤–∞—Ç—å
int& rx = rrx; // rrx - –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä => lvalue
```

move –ø–æ–∑–≤–æ–ª—è–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å rvalue-—Å—Å—ã–ª–∫—É –ø–æ—Å—Ä–µ–¥—Å—Ç–≤–æ–º lvalue

*Note:* –∫–æ–≥–¥–∞ –≤—ã–≤–æ–¥–∏—Ç—Å—è –ø–∞—Ä–∞–º–µ—Ç—Ä —à–∞–±–ª–æ–Ω–∞ –¢ —à–∞–±–ª–æ–Ω–Ω–æ–π —Ñ—É–Ω–∫—Ü–∏–∏, –≤—Å–µ –∞–º–ø–µ—Ä—Å–∞–Ω–¥—ã —É –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è, –Ω–æ –Ω–µ –≤ —Å–ª—É—á–∞–µ –ø–µ—Ä–µ–¥–∞—á–∏ –ø–æ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–π —Å—Å—ã–ª–∫–µ

**reference-collapsing** - —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –≤ —Ñ—É–Ω–∫—Ü–∏—è—Ö —Å —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–º–∏ —Å—Å—ã–ª–∫–∞–º–∏

```cpp
template <typename T>
void f(T&& x) {
    ...
}

int y = 5;
f(y); // y - lvalue, T = int&, decltype(x) = int&
```



& + & = &

& + && = &

&& + & = &

&& + && = &&

## reference qualifiers

```cpp
struct S {
    void f() & { // can be called only on lvalues
        ...
    }
    void f() && { // rvalues
        ...
    }
}

S s;
s.f();
std::move(s).f(); // –ø–µ—Ä–µ–≥—Ä—É–∑–∫–∞ –ø–æ —Ç–∏–ø—É —Å—Å—ã–ª–∫–∏ –ª–µ–≤–æ–≥–æ –æ–ø–µ—Ä–∞–Ω–¥–∞
```

## 22

**–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Å—Å—ã–ª–∫–∏**

std::move –¥–æ–ª–∂–Ω–∞ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏ lvalue –∏ rvalue, –ø—Ä–∏—á–µ–º –Ω–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ.

```cpp
f(const T& x); - lvalue and rvalue, but const;
f(T& x); f(T&& x) - only l(r)value;
```

```cpp
template <typename T>
void f(T&& x); - –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –∫–∞–∫ lvalue, —Ç–∞–∫ –∏ rvalue
```

–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–µ–µ, —á–µ–º –ø–µ—Ä–µ–¥–∞—á–∞ –ø–æ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω–æ–π

**–†–µ–∞–ª–∏–∑–∞—Ü–∏—è std::move**

```cpp
template <typename T>
std::remove_reference_t<T>&& move(T&& x) noexcept { // –ø—Ä–µ–≤—Ä–∞—Ç–∏—Ç—å –≤—Å–µ –≤ rvalue
    return static_cast<std::remove_reference_t<T>&&>(x); // –∫–∞—Å—Ç –∫ rvalue - rvalue
}
```

–ï—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º T&&, —Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç ref.collapsing, –∏ –º–æ–∂–µ—Ç –≤–µ—Ä–Ω—É—Ç—å—Å—è lvalue. –ù—É–∂–Ω–∞ –≤—Å–µ–≥–¥–∞ rvalue. –ü–æ—ç—Ç–æ–º—É –Ω—É–∂–Ω–æ —É–±–∏—Ä–∞—Ç—å —ç—Ç–æ—Ç –∞–º–ø–µ—Ä—Å–∞–Ω–¥. 

## 23 (–æ—Ç–ª 11)

**perfect forwarding, std::forward**

```cpp
template <typename... Args>
void emplace_back(const Args&... args) {
    if (sz == cap) reserve(2 * cap);
    AllocTraits::construct(alloc, arr + sz, args...);
    ++sz;
}
```

–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–æ –ø–µ—Ä–µ–¥ push_back –≤ —Ç–æ–º, —á—Ç–æ —Å–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç —Å—Ä–∞–∑—É –ø–æ –Ω—É–∂–Ω–æ–º—É –∞–¥—Ä–µ—Å—É –≤ –ø–∞–º—è—Ç–∏, –ø—Ä–∏ push_back –ø—Ä–∏—à–ª–æ—Å—å –±—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–æ–∑–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç, –ø–æ—Ç–æ–º –µ–≥–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å.

–ù–æ –≤ emplace_back —Ç–æ–∂–µ –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –ø–æ –∫–æ–Ω—Å—Ç —Å—Å—ã–ª–∫–µ. –ê –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞ –æ–±—ä–µ–∫—Ç–∞ —Ç—è–∂–µ–ª–æ –∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –ø–æ –≤—Ä–µ–º–µ–Ω–∏?

–ß–∞—Å—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç–æ–≤ –º.–±. lvalue, —á–∞—Å—Ç—å rvalue, –Ω–∞–¥–æ –ø–µ—Ä–µ–¥–∞—Ç—å –∫–∞–∫ rvalue —Ç–æ–ª—å–∫–æ —Ç–µ, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ –±—ã–ª–∏ rvalue.

```cpp
template <typename... Args>
void emplace_back(Args&&... args) {
    if (sz == cap) reserve(2 * cap);
    AllocTraits::construct(alloc, arr + sz, std::forward<Args>(args)...); // args - lvalue, –Ω–æ —Ç–∏–ø –ª–∏–±–æ &&, –ª–∏–±–æ &
    ++sz;
}
```

```cpp
template <typename T>
T&& forward(std::remove_reference_t<T>& x) noexcept {
    return static_cast<T&&>(X);   
}

forward<T>(type val);
```

val is lvalue => T is type&, decltype(x) = type& => T&& = type&

val is rvalue => T is type, decltype(x) = type& - –ø—Ä–∏–Ω–∏–º–∞–µ–º –≤—Å–µ–≥–¥–∞ –≤—Å–µ —Ä–∞–≤–Ω–æ –ø–æ lvalue-ref => T&& = type&&

![image-20210625231932866](/home/h4zzkr/snap/typora/39/.config/Typora/typora-user-images/image-20210625231932866.png)

## 30

**–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∫–∞ auto**

–ü—Ä–æ–±–ª–µ–º–∞: 

—Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è —Ç–∏–ø–æ–≤, –Ω–∞–ø—Ä–∏–º–µ—Ä –≤ —Å–ª—É—á–∞–µ std::unordered_map —Å –Ω–µ—Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –∞–ª–ª–æ–∫–∞—Ç–æ—Ä–æ–º, –∏–ª–∏ –Ω–∞–ø—Ä–∏–º–µ—Ä, –≤ —Ç–æ–º –∂–µ —Ç–∏–ø–µ –º–æ–∂–Ω–æ —Å–ª—É—á–∞–π–Ω–æ –∑–∞–±—ã–≤–∞—Ç—å –∫–≤–∞–ª–∏—Ñ–∏–∫–∞—Ç–æ—Ä const —É –∫–ª—é—á–∞, –∏ –∫–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ –º–æ–∂–Ω–æ –ø–æ–ª—É—á–∏—Ç—å –ª–∏—à–Ω–∏–µ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è –Ω–∞–ø—Ä–∏–º–µ—Ä –≤ range-based loop. –†–µ—à–µ–Ω–∏–µ —ç—Ç–∏—Ö –ø—Ä–æ–±–ª–µ–º- –∫–ª—é—á–µ–≤–æ–µ —Å–ª–æ–≤–æ auto, –∫–æ—Ç–æ—Ä–æ–µ —Å–æ–æ–±—â–∞–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä—É, —á—Ç–æ —Ç–∏–ø –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏—Å—Ö–æ–¥—è –∏–∑ —Ç–∏–ø–∞ –∏–Ω—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è.

–í auto, –∫–∞–∫ –∏ –≤ T, —Å—Å—ã–ª–∫–∏ –æ—Ç–±—Ä–∞—Å—ã–≤–∞—é—Ç—Å—è.

auto&& y = f(x); // —Ñ–ª–µ—à–±–µ–∫, —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Å—Å—ã–ª–∫–∞

**–Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å**:

- auto –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∞—Ä–≥—É–º–µ–Ω—Ç–∞—Ö —Ñ—É–Ω–∫—Ü–∏–∏; 
- auto –Ω–µ –º–æ–∂–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –≤ –∫–∞—á–µ—Å—Ç–≤–µ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏, –µ—Å–ª–∏ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ä–∞–±–æ—Ç—ã —Ñ—É–Ω–∫—Ü–∏–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç—Å—è –≤–µ—â–∏ —Ä–∞–∑–Ω—ã—Ö —Ç–∏–ø–æ–≤

**decltype ** - –≤ CT –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Ç–∏–ø –≤—ã—Ä–∞–∂–µ–Ω–∏—è, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—Å—ã–ª–∫–∏, –º–æ–∂–Ω–æ –Ω–∞–≤–µ—à–∏–≤–∞—Ç—å –∞–º–ø–µ—Ä—Å–∞–Ω–¥—ã.

```cpp
int x = 1; f<decltype(x)>();
// decltype –Ω–µ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–µ—Ç –∞–º–ø–µ—Ä—Å–∞–Ω–¥—ã
```

```cpp
if epxression is not and identifier:
	if expression is prvalue of type T: decltype(expression) is T
    if expression is lvalue of type T: decltype(expression) is T&
    if expression is xvalue of type T: decltype(expression) is T&&
```

auto –º–æ–∂–Ω–æ –ø–∏—Å–∞—Ç—å –≤ return type —Ñ—É–Ω–∫—Ü–∏–π (–Ω–æ –µ—Å–ª–∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–µ —Ç–∏–ø—ã)

–ü—Ä–∏–º–µ—Ä –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–≥–æ auto:

```cpp
template <typename T>
auto h(const T& x) -> decltype(f(x)) {
    return f(x); // –º–æ–∂–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –∫–∞–∫ lvalue, —Ç–∞–∫ –∏ rvalue
    // –∫–∞–∫ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å –≤–æ–∑–≤—Ä–∞—â. —Ç–∏–ø –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –ø—Ä–∏–Ω—è—Ç–æ–≥–æ –∞—Ä–≥—É–º–µ–Ω—Ç–∞
}

```

**decltype(auto)**

```cpp
template <typename Container>
decltype(auto) get(const Container& container, size_t index) {
    // —Å–≤–µ—Ä—Ö—É decltype(auto) –∞–Ω–∞–ª–æ–≥–∏—á–µ–Ω –ø—Ä–µ–¥—ã–¥—É—â–∏–º –∑–∞–ø–∏—Å—è–º —Å ->
    return container[index];
} // –≤—ã–≤–æ–¥ —Ç–∏–ø–∞ –±–µ–∑ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏—è —Å—Å—ã–ª–æ–∫
```

decltype(auto) p = x; // –∫–∞–∫ auto, –Ω–æ —Å —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –∞–º–ø–µ—Ä—Å–∞–Ω–¥–æ–≤



## 28

**–º–æ—Ç–∏–≤–∏—Ä–æ–≤–∫–∞**

–ü–æ–∑–≤–æ–ª—è—é—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Å–≤–æ–±–æ–∂–¥–∞—Ç—å –Ω–µ–∫–æ—Ç–æ—Ä—ã–π –≤—ã–¥–µ–ª–µ–Ω–Ω—ã–π –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π —Ä–µ—Å—É—Ä—Å (RAII)

**unique_ptr** - –ø—Ä–æ—Å—Ç–µ–π—à–∏–π —É–º–Ω—ã–π —É–∫–∞–∑–∞—Ç–µ–ª—å, –≤–µ–¥–µ—Ç —Å–µ–±—è –∫–∞–∫ c-style pointer, –Ω–æ –µ–≥–æ –Ω–µ–ª—å–∑—è —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å (–µ–¥–∏–Ω–æ–ª–∏—á–Ω–æ –≤–ª–∞–¥–µ–µ—Ç —Ä–µ—Å—É—Ä—Å–æ–º) - –µ–≥–æ –∫–æ–ø–∏—Ä—É—é—â–∏–π –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä –∏ –æ–ø–µ—Ä–∞—Ç–æ—Ä —É–¥–∞–ª–µ–Ω—ã.

–£ unique_ptr —Å—É—â–µ—Å—Ç–≤—É–µ—Ç —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –º–∞—Å—Å–∏–≤–æ–≤: std::unique_ptr<int[]>

```cpp
template<typename T>
class unique_ptr {
private:
   T *ptr;
public:
   unique_ptr(T *ptr) : ptr(ptr) {}
   unique_ptr(const unique_ptr&) = delete;
   unique_ptr &operator=(const unique_ptr &) = delete;

   unique_ptr(unique_ptr&& another) noexcept {
       ptr = another.ptr;
       another.ptr = nullptr;
   };
   unique_ptr& operator=(unique_ptr&& another) noexcept {
       if (&another == this)
           return *this;
       delete ptr;
       ptr = another.ptr;
       another.ptr = nullptr;
       return *this;
   };
   T& operator*() const {
       return *ptr;
   }
   T* operator->() const noexcept {
       return ptr;
   }
   ~unique_ptr() {
       delete ptr;
   }
};

```

```cpp
template <typename T, typename... Args>
unique_ptr<T> make_unique(Args&&... args) {
    return unique_ptr<T>(new T(std::forward<Args>(args)...));
}
```



## 29

**shared_ptr -** –ø–æ–∑–≤–æ–ª—è–µ—Ç —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —É–∫–∞–∑–∞—Ç–µ–ª–µ–π –Ω–∞ –æ–¥–Ω–æ –∏ —Ç–æ –∂–µ, –ø—Ä–∏ —ç—Ç–æ–º —É–¥–∞–ª–µ–Ω–∏–µ –±—É–¥–µ—Ç –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ - –∫–æ–≥–¥–∞ –≤—Å–µ –∫–æ–ø–∏–∏ —É–º—Ä—É—Ç.

*Implementation draft*

```cpp
#include <iostream>

template <typename T>
class shared_ptr {
    T* ptr = nullptr;
    size_t* count = nullptr;
public:
    shared_ptr() {}
    explicit shared_ptr(T* ptr): ptr(ptr), count(new size_t(1)) {}
    
    shared_ptr(const shared_ptr& other): ptr(other.ptr), count(other.count) {
        ++*count;
    }
    
    shared_ptr(shared_ptr&& other): ptr(other.ptr), count(other.count) {
        other.ptr = nullptr;
        other.count = nullptr;
    }
    
    shared_ptr& operator=(const shared_ptr& other) {
        ~shared_ptr();
        ptr = other.ptr;
        count = other.count;
        ++*count;
    }
    
    shared_ptr& operator=(shared_ptr&& other) {
        if (&other == this)
           return *this;
        ~shared_ptr();
        ptr = other.ptr;
        count = other.count;
        other.ptr = nullptr;
        other.count = nullptr;
    }

    T& operator*() {
      return *ptr;
    }

    T* operator->() {
      return ptr;
    }
    
    ~shared_ptr() {
        if (!count) return;
        --*count;
        if (!*count) {
            delete ptr;
            delete count;
        }
    }
};

int main() {
  shared_ptr<int> a(new int); // bad style
}
```

**–ü—Ä–∏–Ω—Ü–∏–ø: –Ω–µ —Å–ª–µ–¥—É–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å c-style pointers —Å shared_pointers**

```cpp
void g(const shared_ptr<int>& p, int x) {}
int f(int x) {
    throw std::runtime_error();
}
g(shared_ptr<int>(new int(5)), f(0));
// –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –º–æ–∂–µ—Ç –≤—ã—á–∏—Å–ª—è—Ç—å –∞—Ä–≥—É–º–µ–Ω—Ç—ã –≤ –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω–æ–º –ø–æ—Ä—è–¥–∫–µ, –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π memory leak
```

–ß—Ç–æ–±—ã –∏–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç —Ä—É—á–Ω–æ–≥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è new, –Ω–∞–ø–∏—à–µ–º —Ñ—É–Ω–∫—Ü–∏—é make_shared (make_unique).

```cpp
template <typename T, typename... Args>
shared_ptr<T> make_shared(Args&&... args) {
    // –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è, –æ–¥–∏–Ω –≤—ã–∑–æ–≤ new –≤–º–µ—Å—Ç–æ –¥–≤—É—Ö
    auto p = ControlBlock();
    return shared_ptr<T>(p);
}
```

## 31

```cpp
[](int x, int y) { return x < y; }
[](int x) { std::cout << x << '\n' }(4);
auto f = [](int y) { return y * 2; }
```

```cpp
[](int x, int y) -> bool { ... }; // –∑–∞–¥–∞—Ç—å —è–≤–Ω–æ —Ç–∏–ø –≤–æ–∑–≤—Ä–∞—â–∞–µ–º–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è
```

**capture lists**

```cpp
int a = 1;
[a](int x) { return a + x; } // –∑–∞—Ö–≤–∞—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π –≤ —Ñ—É–Ω–∫—Ü–∏–∏
```

```cpp
[a](int x) {++a;
           std::cout << a;} // CE, –∑–∞—Ö–≤–∞—á–µ–Ω–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–µ —Å —Ç.—á. —Ñ—É–Ω–∫—Ü–∏–∏
```

```cpp
[a, b](int x) mutable {...} // —Ç–µ–ø–µ—Ä—å –≤—Å–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω—è–µ–º—ã–µ, –Ω–æ –Ω–∞ –∏—Å—Ö–æ–¥–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –Ω–µ –ø–æ–≤–ª–∏—è—é—Ç
```

```cpp
[&a, b](int x) {
    ++a; return 1;
} // —Ç–µ–ø–µ—Ä—å a –º–µ–Ω—è–µ—Ç—Å—è, –∑–∞—Ö–≤–∞—Ç –ø–æ —Å—Å—ã–ª–∫–µ
```

## 32

**sfinae, –∏–¥–µ—è**

–ù–µ—É–¥–∞—á–Ω–∞—è —à–∞–±–ª–æ–Ω–Ω–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ - –Ω–µ –æ—à–∏–±–∫–∞ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

```cpp
template <typename T>
auto f(const T&) -> decltype(T().size()) { std::cout << 1; }

int f(...) { std::cout << 2; return 0; }

f(std::vector<int>(4)); // ok, first ver
f(4); // –Ω–µ—É–¥–∞—á–Ω–∞—è –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤ –ø–µ—Ä–≤—É—é –≤–µ—Ä—Å–∏—é, –≤—ã–±–æ—Ä 2–π - SFINAE
```

–†–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è —Å–∏–≥–Ω–∞—Ç—É—Ä —Ñ—É–Ω–∫—Ü–∏–π/–∫–ª–∞—Å—Å–æ–≤. –í —Ç–µ–ª–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±—É–¥–µ—Ç CE. –≠—Ç–æ –ø—Ä–∞–≤–∏–ª–æ, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –≤ –º–æ–º–µ–Ω—Ç –≤—ã–±–æ—Ä–∞ –≤–µ—Ä—Å–∏–π

**std::enable_if**

```cpp
template <typename T, typename = std::enable_if_t<std::is_class_v<std::remove_reference_t<T>>>>
void g(const T&) {
	std::cout << 1;
}

template <typename T, typename = std::enable_f_t<!std::is_class_v<std::remove_reference_t<T>>>>
void g(T&&) {
	std::cout << 2;
}
```

```cpp
template <bool B, typename T = void>
struct ebable_if {};

template<typename T>
struct enable_if<true, T> {
    using type = T;
}

template <bool B, typename T>
using enable_if_t = typename enable_if<B,T>::type;
```

–ï—Å–ª–∏ –ø–æ–ø–∞–¥–∞–µ–º –≤ <false,T>, —Ç–æ —Ñ–∏–∫—Ç–∏–≤–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç => —Å—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç sfinae

## 11

**fibonacci**

```cpp
#include <iostream>

// Fibonacci
template <size_t N>
struct Fibonacci {
  static const size_t value = Fibonacci<N-1>::value + Fibonacci<N-2>::value;
};

template <>
struct Fibonacci<0> { static const size_t value = 0; };

template <>
struct Fibonacci<1> { static const size_t value = 1; };
```

**isPrime**

```cpp
#include <iostream>
template <size_t N, size_t D>
struct isPrimeHelper {
  static const bool value = (N % D == 0) ? false : isPrimeHelper<N, D-1>::value;
};

template <size_t N>
struct isPrimeHelper<N, 1> {
  static const bool value = true;
};

template <size_t N>
struct isPrime {
  static const bool value = isPrimeHelper<N, N-1>::value;
  // –¥–ª—è O(N) –∑–∞–ø—É—Å—Ç–∏—Ç—å—Å—è –æ—Ç <N, N - 1>
};

template <>
struct isPrime<1> {
  static const bool value = false;
};

int main() {
  std::cout << isPrime<73>::value;
}
```

## 33

```cpp
int x;
std::cin >> x;
const int y = x; // –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ —Ä–µ–∞–ª—å–Ω–æ–≥–æ –≤—Ä–µ–º–µ–Ω–∏

constexpr int y = x; // CE
```

**constexpr** - –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –≤—Ä–µ–º–µ–Ω–∏ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –æ–±—è–∑–∞–Ω–∞ –±—ã—Ç—å –≤—ã—á–∏—Å–ª–µ–Ω–∞ –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

```cpp
std::array<int, n> a; // n is constexpr
static const int val = ... // constexpr
```

```cpp
constexpr int factorial(int n) {
    ...
}

constexpr int y = factorial(5);
```

–ß—Ç–æ–±—ã –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ —Å—á–∏—Ç–∞–ª—Å—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–Ω—ã–º –≤—ã—Ä–∞–∂–µ–Ω–∏–µ–º, —Ñ—É–Ω–∫—Ü–∏—è –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å constexpr, —Ç.–µ. —Ç–∞–∫–∞—è, –∫–æ—Ç–æ—Ä–∞—è –º–± –≤—ã–∑–≤–∞–Ω–∞ –≤ compile time —Ä–∞–¥–∏ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è constexpr –∫–æ–Ω—Å—Ç–∞–Ω—Ç—ã.

**since cpp17 - if constexpr** - –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏, –ª–æ–∂–Ω–∞—è –≤–µ—Ç–∫–∞ –Ω–µ –±—É–¥–µ—Ç –∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞—Ç—å—Å—è

–†–∞–∑—Ä–µ—à–∞–µ—Ç—Å—è —Ä–∞–±–æ—Ç–∞—Ç—å —Ç–æ–ª—å–∫–æ constexpr –≤—ã—Ä–∞–∂–µ–Ω–∏—è–º–∏.

–ù–µ–ª—å–∑—è —Ä–∞–±–æ—Ç–∞—Ç—å —Å –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–π –ø–∞–º—è—Ç—å—é –≤ constexpr —Ñ—É–Ω–∫—Ü–∏—è—Ö. –°–æ–∑–¥–∞–≤–∞—Ç—å –æ–±—ä–µ–∫—Ç—ã —Å –Ω–µ constexpr –∫–æ–≥—Å—Ç—Ä—É–∫—Ç–æ—Ä–∞–º–∏ –Ω–µ–ª—å–∑—è. –ë—Ä–æ—Å–∞—Ç—å –∏—Å–∫–ª—é—á–µ–Ω–∏—è —Ç–æ–∂–µ –Ω–µ–ª—å–∑—è –≤ compile time (–µ—Å–ª–∏ –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –∑–∞–π–¥–µ—Ç –≤ –≤–µ—Ç–∫—É, –≥–¥–µ –±—Ä–æ—Å–∞–µ—Ç—Å—è –∏—Å–∫–ª—é—á–µ–Ω–∏–µ)

–¢–æ, —á—Ç–æ —Ñ—É–Ω–∫—Ü–∏—è constexpr, –Ω–µ –æ–±—è–∑—ã–≤–∞–µ—Ç –∫–æ–º–ø–∏–ª—è—Ç–æ—Ä –≤—Å–µ–≥–¥–∞ –µ–µ –≤—ã—á–∏—Å–ª—è—Ç—å –Ω–∞ —ç—Ç–∞–ø–µ –∫–æ–º–ø–∏–ª—è—Ü–∏–∏

![image-20210627155436722](/home/h4zzkr/snap/typora/39/.config/Typora/typora-user-images/image-20210627155436722.png) 



## 24 - Vector

**reserve** –¥–æ–ª–∂–µ–Ω –ø—Ä–æ—Å—Ç–æ –≤—ã–¥–µ–ª—è—Ç—å –ø–∞–º—è—Ç—å, –∞ –Ω–µ –∫–æ–Ω—Å—Ç—Ä—É–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ –Ω–µ–π —á—Ç–æ-–ª–∏–±–æ. 

```cpp
void reserve(size_t n) {
    if (n <= capacity) return;
    T* newarr = AllocTraits::allocate(alloc, n);
    for (size_t i = 0; i < size; ++i)
        AllocTraits::construct(alloc, newarr + i, std::move(arr[i]));
    for (size_t i = 0; i < size; ++i)
        AllocTraits::destroy(alloc, arr + i);
    AllocTraits::deallocate(arr, capacity);
    capacity = n;
    arr = newarr;
}

void push_back(const T& value) {
    if (size == capacity)
        reserve(2 * capacity);
    AllocTraits::construct(alloc, arr + size, value);
    ++size;
}

void resize(size_t n, const T& value = T()) {
    if (n > capacity) reserve(n);
    if (n > size) { ... } // add some values with value
    else if (n < size) { ... } // remove some values
}
```



## 25 vector<bool>

```cpp
// –ø–∞–∫—É–µ–º –ø–æ 8 –±–∏—Ç –≤ –æ–¥–Ω–æ–π —è—á–µ–π–∫–µ
template <>
class Vector<bool> {
    int8_t* arr;
    size_t size;
    size_t capacity;
    
    struct BitReference {
        int8_t* cell;
        uint8_t pos;
        
        BitReference& operator=(bool b) {
            if (b)
                *cell |= (1u << pos);
            else
                *cell &= ~(1u << pos);
        }
        
        operator bool() const {
            return *cell & (1u << pos);
        }
    }
    
public:
    BitReference operator[](size_t i) {
        return BitReference{arr + i / 8, i % 8};
    }
}
```